<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
--><!DOCTYPE html>


<html>
<head>
  <title>Session 01 &mdash; Internet Programming with Python</title>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="stylesheet" media="all"
        href="../_static/theme/css/default.css">
  <link rel="stylesheet" media="all"
        href="../_static/theme/css/hieroglyph.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)"
        href="../_static/theme/css/phone.css">

    
    <link rel="stylesheet" href="../_static/custom.css"
          type="text/css" />
    

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script data-main="../_static/js/slides"
            src="../_static/js/require-1.0.8.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <link rel="top" title="Internet Programming with Python" href="../index.html" />
    <link rel="up" title="Course Presentations" href="index.html" />
    <link rel="next" title="Session 02" href="session02.html" />
    <link rel="prev" title="Course Presentations" href="index.html" /> 
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
  <aside class="gdbar"><img src="../_static/logo_UW.png"></aside>
  <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
  <hgroup class="auto-fadein">
    <h1 data-config-title><!-- populated from slide_config.json --></h1>
    <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
    <p data-config-presenter><!-- populated from slide_config.json --></p>
  </hgroup>
</slide>

  
    <slide class="title-slide segue nobackground level-1" id="session-01">
    <hgroup>
      <h1>Session 01</h1>
    </hgroup>
    <article class="">
      <div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/python.png"><img alt="../_images/python.png" src="../_images/python.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-text"><strong>Networking and Sockets</strong></span></p>
</div>



<div class="slide-no">1</div>


    </article>
  </slide>  <slide class="level-2" id="computer-communications">
    <hgroup>
      <h2>Computer Communications</h2>
    </hgroup>
    <article class="">
      <p class="large centered">Wherein we learn about how computers speak to each-other over a network.</p>



<div class="slide-no">2</div>


    </article>
  </slide>  <slide class="level-3" id="but-first">
    <hgroup>
      <h3>But First</h3>
    </hgroup>
    <article class="">
      <div class="left container">
<p>Class presentations are available online for your use</p>
<p class="small"><a class="reference external" href="https://github.com/UWPCE-PythonCert/training.python_web">https://github.com/UWPCE-PythonCert/training.python_web</a></p>
<div class="build container">
<p>Licensed with Creative Commons BY-NC-SA</p>
<ul class="build simple">
<li>You must attribute the work</li>
<li>You may not use the work for commercial purposes</li>
<li>You have to share your versions just like this one</li>
</ul>
<p>Find mistakes? See improvements? Make a pull request.</p>
</div>
</div>



<div class="slide-no">3</div>


    </article>
  </slide>  <slide class="level-3" id="id5">
    <hgroup>
      <h3>But First</h3>
    </hgroup>
    <article class="">
      <p>The rendered documentation is available as well:</p>
<p><a class="reference external" href="http://uwpce-pythoncert.github.io">http://uwpce-pythoncert.github.io</a></p>
<p>Please check frequently. I will update with great regularity</p>



<div class="slide-no">4</div>


    </article>
  </slide>  <slide class="level-3" id="id6">
    <hgroup>
      <h3>But First</h3>
    </hgroup>
    <article class="">
      <p><strong>Classroom Protocol</strong></p>
<div class="build container">
<p>Questions to ask:</p>
<ul class="build simple">
<li>What did you just say?</li>
<li>Please explain what we just did again?</li>
<li>How did that work?</li>
<li>Why didn't that work for me?</li>
<li>Is that a typo?</li>
</ul>
</div>



<div class="slide-no">5</div>


    </article>
  </slide>  <slide class="level-3" id="id7">
    <hgroup>
      <h3>But First</h3>
    </hgroup>
    <article class="">
      <p><strong>Classroom Protocol</strong></p>
<div class="build container">
<p>Questions <strong>not</strong> to ask:</p>
<ul class="build simple">
<li><strong>Hypotheticals</strong>: What happens if I do X?</li>
<li><strong>Research</strong>: Can Python do Y?</li>
<li><strong>Syllabus</strong>: Are we going to cover Z in class?</li>
<li><strong>Marketing questions</strong>: please just don't.</li>
<li><strong>Performance questions</strong>: Is Python fast enough?</li>
<li><strong>Unpythonic</strong>: Why doesn't Python do it some other way?</li>
<li><strong>Show off</strong>: Look what I just did!</li>
</ul>
</div>



<div class="slide-no">6</div>


    </article>
  </slide>  <slide class="level-3" id="id8">
    <hgroup>
      <h3>But First</h3>
    </hgroup>
    <article class="">
      <p class="large center">Introductions</p>



<div class="slide-no">7</div>


    </article>
  </slide>  <slide class="level-3" id="tcp-ip">
    <hgroup>
      <h3>TCP/IP</h3>
    </hgroup>
    <article class="">
      <div class="figure align-left" id="id3">
<img alt="../_images/network_topology.png" src="../_images/network_topology.png" />
<p class="caption"><span class="caption-text"><a class="reference external" href="http://en.wikipedia.org/wiki/Internet_Protocol_Suite">http://en.wikipedia.org/wiki/Internet_Protocol_Suite</a></span></p>
</div>
<ul class="build simple">
<li>processes can communicate</li>
<li>inside one machine</li>
<li>between two machines</li>
<li>among many machines</li>
</ul>



<div class="slide-no">8</div>


    </article>
  </slide>  <slide class="level-3" id="id9">
    <hgroup>
      <h3>TCP/IP</h3>
    </hgroup>
    <article class="">
      <div class="figure align-left" id="id4">
<a class="reference internal image-reference" href="../_images/data_in_tcpip_stack.png"><img alt="../_images/data_in_tcpip_stack.png" src="../_images/data_in_tcpip_stack.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><a class="reference external" href="http://en.wikipedia.org/wiki/Internet_Protocol_Suite">http://en.wikipedia.org/wiki/Internet_Protocol_Suite</a></span></p>
</div>
<ul class="build simple">
<li>Process divided into 'layers'</li>
<li>'Layers' are mostly arbitrary</li>
<li>Different descriptions have different layers</li>
<li>Most common is the 'TCP/IP Stack'</li>
</ul>



<div class="slide-no">9</div>


    </article>
  </slide>  <slide class="level-3" id="the-tcp-ip-stack-link">
    <hgroup>
      <h3>The TCP/IP Stack - Link</h3>
    </hgroup>
    <article class="">
      <p>The bottom layer is the 'Link Layer'</p>
<ul class="build simple">
<li>Deals with the physical connections between machines, 'the wire'</li>
<li>Packages data for physical transport</li>
<li>Executes transmission over a physical medium<ul class="build">
<li>what that medium is is arbitrary</li>
</ul>
</li>
<li>Implemented in the Network Interface Card(s) (NIC) in your computer</li>
</ul>



<div class="slide-no">10</div>


    </article>
  </slide>  <slide class="level-3" id="the-tcp-ip-stack-internet">
    <hgroup>
      <h3>The TCP/IP Stack - Internet</h3>
    </hgroup>
    <article class="">
      <p>Moving up, we have the 'Internet Layer'</p>
<ul class="build simple">
<li>Deals with addressing and routing<ul class="build">
<li>Where are we going and how do we get there?</li>
</ul>
</li>
<li>Agnostic as to physical medium (IP over Avian Carrier - IPoAC)</li>
<li>Makes no promises of reliability</li>
<li>Two addressing systems<ul class="build">
<li>IPv4 (current, limited '192.168.1.100')</li>
<li>IPv6 (future, 3.4 x 10^38 addresses, '2001:0db8:85a3:0042:0000:8a2e:0370:7334')</li>
</ul>
</li>
</ul>



<div class="slide-no">11</div>


    </article>
  </slide>  <slide class="level-3" id="id10">
    <hgroup>
      <h3>The TCP/IP Stack - Internet</h3>
    </hgroup>
    <article class="">
      <p class="large center">That's 4.3 x 10^28 addresses <em>per person alive today</em></p>



<div class="slide-no">12</div>


    </article>
  </slide>  <slide class="level-3" id="the-tcp-ip-stack-transport">
    <hgroup>
      <h3>The TCP/IP Stack - Transport</h3>
    </hgroup>
    <article class="">
      <p>Next up is the 'Transport Layer'</p>
<ul class="build simple">
<li>Deals with transmission and reception of data<ul>
<li>error correction, flow control, congestion management</li>
</ul>
</li>
<li>Common protocols include TCP &amp; UDP<ul>
<li>TCP: Tranmission Control Protocol</li>
<li>UDP: User Datagram Protocol</li>
</ul>
</li>
<li>Not all Transport Protocols are 'reliable'<ul class="build">
<li>TCP ensures that dropped packets are resent</li>
<li>UDP makes no such assurance</li>
<li>Reliability is slow and expensive</li>
</ul>
</li>
</ul>



<div class="slide-no">13</div>


    </article>
  </slide>  <slide class="level-3" id="id11">
    <hgroup>
      <h3>The TCP/IP Stack - Transport</h3>
    </hgroup>
    <article class="">
      <p>The 'Transport Layer' also establishes the concept of a <strong>port</strong></p>
<div class="build container">
<ul class="build simple">
<li>IP Addresses designate a specific <em>machine</em> on the network</li>
<li>A <strong>port</strong> provides addressing for individual <em>applications</em> in a single
host</li>
<li>192.168.1.100:80  (the <em>:80</em> part is the <strong>port</strong>)</li>
<li>[2001:db8:85a3:8d3:1319:8a2e:370:7348]:443 (<em>:443</em> is the <strong>port</strong>)</li>
</ul>
<p>This means that you don't have to worry about information intended for your
web browser being accidentally read by your email client.</p>
</div>



<div class="slide-no">14</div>


    </article>
  </slide>  <slide class="level-3" id="id12">
    <hgroup>
      <h3>The TCP/IP Stack - Transport</h3>
    </hgroup>
    <article class="">
      <p>There are certain <strong>ports</strong> which are commonly understood to belong to given
applications or protocols:</p>
<div class="build container">
<ul class="build simple">
<li>80/443 - HTTP/HTTPS</li>
<li>20 - FTP</li>
<li>22 - SSH</li>
<li>23 - Telnet</li>
<li>25 - SMTP</li>
<li>...</li>
</ul>
<p>These ports are often referred to as <strong>well-known ports</strong></p>
<p class="small">(see <a class="reference external" href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a>)</p>
</div>



<div class="slide-no">15</div>


    </article>
  </slide>  <slide class="level-3" id="id13">
    <hgroup>
      <h3>The TCP/IP Stack - Transport</h3>
    </hgroup>
    <article class="">
      <p>Ports are grouped into a few different classes</p>
<ul class="build simple">
<li>Ports numbered 0 - 1023 are <em>reserved</em></li>
<li>Ports numbered 1024 - 65535 are <em>open</em></li>
<li>Ports numbered 1024 - 49151 may be <em>registered</em></li>
<li>Ports numbered 49152 - 65535 are called <em>ephemeral</em></li>
</ul>



<div class="slide-no">16</div>


    </article>
  </slide>  <slide class="level-3" id="the-tcp-ip-stack-application">
    <hgroup>
      <h3>The TCP/IP Stack - Application</h3>
    </hgroup>
    <article class="">
      <p>The topmost layer is the 'Application Layer'</p>
<div class="build container">
<ul class="build simple">
<li>Deals directly with data produced or consumed by an application</li>
<li>Reads or writes data using a set of understood, well-defined <strong>protocols</strong><ul>
<li>HTTP, SMTP, FTP etc.</li>
</ul>
</li>
<li>Does not know (or need to know) about lower layer functionality<ul>
<li>The exception to this rule is <strong>endpoint</strong> data (or IP:Port)</li>
</ul>
</li>
</ul>
<p class="centered"><strong>this is where we live and work</strong></p>
</div>



<div class="slide-no">17</div>


    </article>
  </slide>  <slide class="level-3" id="sockets">
    <hgroup>
      <h3>Sockets</h3>
    </hgroup>
    <article class="">
      <p>Think back for a second to what we just finished discussing, the TCP/IP stack.</p>
<div class="build container">
<ul class="build simple">
<li>The <em>Internet</em> layer gives us an <strong>IP Address</strong></li>
<li>The <em>Transport</em> layer establishes the idea of a <strong>port</strong>.</li>
<li>The <em>Application</em> layer doesn't care about what happens below...</li>
<li><em>Except for</em> <strong>endpoint data</strong> (IP:Port)</li>
</ul>
<p>A <strong>Socket</strong> is the software representation of that endpoint.</p>
<p>Opening a <strong>socket</strong> creates a kind of transceiver that can send and/or
receive <em>bytes</em> at a given IP address and Port.</p>
</div>



<div class="slide-no">18</div>


    </article>
  </slide>  <slide class="level-3" id="sockets-in-python">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>Python provides a standard library module which provides socket functionality.
It is called <strong>socket</strong>.</p>
<div class="build container">
<p>The library is really just a very thin wrapper around the system
implementation of <em>BSD Sockets</em></p>
<p>Let's spend a few minutes getting to know this module.</p>
<p>We're going to do this next part together, so open up a terminal and start
an iPython interpreter</p>
</div>



<div class="slide-no">19</div>


    </article>
  </slide>  <slide class="level-3" id="id14">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>The Python sockets library allows us to find out what port a <em>service</em> uses:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">socket</span>

<span class="gp">In [2]: </span><span class="n">socket</span><span class="o">.</span><span class="n">getservbyname</span><span class="p">(</span><span class="s">&#39;ssh&#39;</span><span class="p">)</span>
<span class="gh">Out[2]: </span><span class="go">22</span>
</pre></div>
</div>
<p>You can also do a <em>reverse lookup</em>, finding what service uses a given <em>port</em>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="n">socket</span><span class="o">.</span><span class="n">getservbyport</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
<span class="gh">Out[3]: </span><span class="go">&#39;http&#39;</span>
</pre></div>
</div>
</div>



<div class="slide-no">20</div>


    </article>
  </slide>  <slide class="level-3" id="id15">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>The sockets library also provides tools for finding out information about
<em>hosts</em>. For example, you can find out about the hostname and IP address of
the machine you are currently using:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
<span class="gh">Out[4]: </span><span class="go">&#39;Banks&#39;</span>

<span class="gp">In [5]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
<span class="gh">Out[5]: </span><span class="go">&#39;127.0.0.1&#39;</span>
</pre></div>
</div>



<div class="slide-no">21</div>


    </article>
  </slide>  <slide class="level-3" id="id16">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>You can also find out about machines that are located elsewhere, assuming you
know their hostname. For example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s">&#39;google.com&#39;</span><span class="p">)</span>
<span class="gh">Out[6]: </span><span class="go">&#39;173.194.33.100&#39;</span>

<span class="gp">In [7]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s">&#39;uw.edu&#39;</span><span class="p">)</span>
<span class="gh">Out[7]: </span><span class="go">&#39;128.95.155.134&#39;</span>

<span class="gp">In [8]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s">&#39;crisewing.com&#39;</span><span class="p">)</span>
<span class="gh">Out[8]: </span><span class="go">&#39;108.168.213.86&#39;</span>
</pre></div>
</div>



<div class="slide-no">22</div>


    </article>
  </slide>  <slide class="level-3" id="id17">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>The <code class="docutils literal"><span class="pre">gethostbyname_ex</span></code> method of the <code class="docutils literal"><span class="pre">socket</span></code> library provides more
information about the machines we are exploring:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [9]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="s">&#39;crisewing.com&#39;</span><span class="p">)</span>
<span class="gh">Out[9]: </span><span class="go">(&#39;crisewing.com&#39;, [], [&#39;108.168.213.86&#39;])</span>

<span class="gp">In [10]: </span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="s">&#39;google.com&#39;</span><span class="p">)</span>
<span class="gh">Out[10]:</span>
<span class="go">(&#39;google.com&#39;,</span>
<span class="go"> [],</span>
<span class="go"> [&#39;173.194.33.100&#39;, &#39;173.194.33.103&#39;,</span>
<span class="go">  ...</span>
<span class="go">  &#39;173.194.33.97&#39;, &#39;173.194.33.104&#39;])</span>
</pre></div>
</div>



<div class="slide-no">23</div>


    </article>
  </slide>  <slide class="level-3" id="id18">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>To create a socket, you use the <strong>socket</strong> method of the <code class="docutils literal"><span class="pre">socket</span></code> library.
It takes up to three optional positional arguments (here we use none to get
the default behavior):</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [11]: </span><span class="n">foo</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>

<span class="gp">In [12]: </span><span class="n">foo</span>
<span class="gh">Out[12]: </span><span class="go">&lt;socket.socket fd=10, family=AddressFamily.AF_INET,</span>
<span class="go">          type=SocketKind.SOCK_STREAM, proto=0, laddr=(&#39;0.0.0.0&#39;, 0)&gt;</span>
</pre></div>
</div>



<div class="slide-no">24</div>


    </article>
  </slide>  <slide class="level-3" id="id19">
    <hgroup>
      <h3>Sockets in Python</h3>
    </hgroup>
    <article class="">
      <p>A socket has some properties that are immediately important to us. These
include the <em>family</em>, <em>type</em> and <em>protocol</em> of the socket:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [13]: </span><span class="n">foo</span><span class="o">.</span><span class="n">family</span>
<span class="gh">Out[13]: </span><span class="go">&lt;AddressFamily.AF_INET: 2&gt;</span>

<span class="gp">In [14]: </span><span class="n">foo</span><span class="o">.</span><span class="n">type</span>
<span class="gh">Out[14]: </span><span class="go">&lt;SocketKind.SOCK_STREAM: 1&gt;</span>

<span class="gp">In [15]: </span><span class="n">foo</span><span class="o">.</span><span class="n">proto</span>
<span class="gh">Out[15]: </span><span class="go">0</span>
</pre></div>
</div>
<p>You might notice that the values for these properties are integers.  In
fact, these integers are <strong>constants</strong> defined in the socket library.</p>
</div>



<div class="slide-no">25</div>


    </article>
  </slide>  <slide class="level-3" id="id20">
    <hgroup>
      <h3>A quick utility method</h3>
    </hgroup>
    <article class="">
      <p>Let's define a method in place to help us see these constants. It will take a
single argument, the shared prefix for a defined set of constants:</p>
<div class="build container">
<p>(you can also find this in <code class="docutils literal"><span class="pre">resources/session01/socket_tools.py</span></code>)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [37]: </span><span class="k">def</span> <span class="nf">get_constants</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="sd">&quot;&quot;&quot;mapping of socket module constants to their names&quot;&quot;&quot;</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="p">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span> <span class="n">n</span>
<span class="gp">   ....: </span>            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="gp">   ....: </span>            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="p">}</span>
<span class="gp">   ....:</span>
</pre></div>
</div>
</div>



<div class="slide-no">26</div>


    </article>
  </slide>  <slide class="level-3" id="socket-families">
    <hgroup>
      <h3>Socket Families</h3>
    </hgroup>
    <article class="">
      <p>Think back a moment to our discussion of the <em>Internet</em> layer of the TCP/IP
stack.  There were a couple of different types of IP addresses:</p>
<div class="build container">
<ul class="build simple">
<li>IPv4 ('192.168.1.100')</li>
<li>IPv6 ('2001:0db8:85a3:0042:0000:8a2e:0370:7334')</li>
</ul>
<p>The <strong>family</strong> of a socket corresponds to the <em>addressing system</em> it uses
for connecting.</p>
</div>



<div class="slide-no">27</div>


    </article>
  </slide>  <slide class="level-3" id="id21">
    <hgroup>
      <h3>Socket Families</h3>
    </hgroup>
    <article class="">
      <p>Families defined in the <code class="docutils literal"><span class="pre">socket</span></code> library are prefixed by <code class="docutils literal"><span class="pre">AF_</span></code>:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [39]: </span><span class="n">families</span> <span class="o">=</span> <span class="n">get_constants</span><span class="p">(</span><span class="s">&#39;AF_&#39;</span><span class="p">)</span>

<span class="gp">In [40]: </span><span class="n">families</span>
<span class="gh">Out[40]:</span>
<span class="go">{&lt;AddressFamily.AF_UNSPEC: 0&gt;: &#39;AF_UNSPEC&#39;,</span>
<span class="go"> &lt;AddressFamily.AF_UNIX: 1&gt;: &#39;AF_UNIX&#39;,</span>
<span class="go"> &lt;AddressFamily.AF_INET: 2&gt;: &#39;AF_INET&#39;,</span>
<span class="go"> ...</span>
<span class="go"> &lt;AddressFamily.AF_INET6: 30&gt;: &#39;AF_INET6&#39;,</span>
<span class="go"> &lt;AddressFamily.AF_SYSTEM: 32&gt;: &#39;AF_SYSTEM&#39;}</span>
</pre></div>
</div>
<p><em>Your results may vary</em></p>
<p>Of all of these, the ones we care most about are <code class="docutils literal"><span class="pre">2</span></code> (IPv4) and <code class="docutils literal"><span class="pre">30</span></code>
(IPv6).</p>
</div>



<div class="slide-no">28</div>


    </article>
  </slide>  <slide class="level-3" id="id22">
    <hgroup>
      <h3>Unix Domain Sockets</h3>
    </hgroup>
    <article class="">
      <p>When you are on a machine with an operating system that is Unix-like, you will
find another generally useful socket family: <code class="docutils literal"><span class="pre">AF_UNIX</span></code>, or Unix Domain
Sockets. Sockets in this family:</p>
<ul class="build simple">
<li>connect processes <strong>on the same machine</strong></li>
<li>are generally a bit slower than IPC connnections</li>
<li>have the benefit of allowing the same API for programs that might run on one
machine __or__ across the network</li>
<li>use an 'address' that looks like a pathname ('/tmp/foo.sock')</li>
</ul>



<div class="slide-no">29</div>


    </article>
  </slide>  <slide class="level-3" id="id23">
    <hgroup>
      <h3>Test your skills</h3>
    </hgroup>
    <article class="">
      <p>What is the <em>default</em> family for the socket we created just a moment ago?</p>
<div class="build container">
<p>(remember we bound the socket to the symbol <code class="docutils literal"><span class="pre">foo</span></code>)</p>
<p>How did you figure this out?</p>
</div>



<div class="slide-no">30</div>


    </article>
  </slide>  <slide class="level-3" id="socket-types">
    <hgroup>
      <h3>Socket Types</h3>
    </hgroup>
    <article class="">
      <p>The socket <em>type</em> determines the semantics of socket communications.</p>
<div class="build container">
<p>Look up socket type constants with the <code class="docutils literal"><span class="pre">SOCK_</span></code> prefix:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [42]: </span><span class="n">types</span> <span class="o">=</span> <span class="n">get_constants</span><span class="p">(</span><span class="s">&#39;SOCK_&#39;</span><span class="p">)</span>

<span class="gp">In [43]: </span><span class="n">types</span>
<span class="gh">Out[43]:</span>
<span class="go">{&lt;SocketKind.SOCK_STREAM: 1&gt;: &#39;SOCK_STREAM&#39;,</span>
<span class="go"> &lt;SocketKind.SOCK_DGRAM: 2&gt;: &#39;SOCK_DGRAM&#39;,</span>
<span class="go"> &lt;SocketKind.SOCK_RAW: 3&gt;: &#39;SOCK_RAW&#39;,</span>
<span class="go"> &lt;SocketKind.SOCK_RDM: 4&gt;: &#39;SOCK_RDM&#39;,</span>
<span class="go"> &lt;SocketKind.SOCK_SEQPACKET: 5&gt;: &#39;SOCK_SEQPACKET&#39;}</span>
</pre></div>
</div>
<p>The most common are <code class="docutils literal"><span class="pre">1</span></code> (Stream communication (TCP)) and <code class="docutils literal"><span class="pre">2</span></code> (Datagram
communication (UDP)).</p>
</div>



<div class="slide-no">31</div>


    </article>
  </slide>  <slide class="level-3" id="id24">
    <hgroup>
      <h3>Test your skills</h3>
    </hgroup>
    <article class="">
      <p>What is the <em>default</em> type for our generic socket, <code class="docutils literal"><span class="pre">foo</span></code>?</p>



<div class="slide-no">32</div>


    </article>
  </slide>  <slide class="level-3" id="socket-protocols">
    <hgroup>
      <h3>Socket Protocols</h3>
    </hgroup>
    <article class="">
      <p>A socket also has a designated <em>protocol</em>. The constants for these are
prefixed by <code class="docutils literal"><span class="pre">IPPROTO_</span></code>:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [45]: </span><span class="n">protocols</span> <span class="o">=</span> <span class="n">get_constants</span><span class="p">(</span><span class="s">&#39;IPPROTO_&#39;</span><span class="p">)</span>

<span class="gp">In [46]: </span><span class="n">protocols</span>
<span class="gh">Out[46]:</span>
<span class="go">{0: &#39;IPPROTO_IP&#39;,</span>
<span class="go"> ...</span>
<span class="go"> 6: &#39;IPPROTO_TCP&#39;,</span>
<span class="go"> ...</span>
<span class="go"> 17: &#39;IPPROTO_UDP&#39;,</span>
<span class="go"> ...}</span>
</pre></div>
</div>
<p>The choice of which protocol to use for a socket is determined by the
<em>internet layer</em> protocol you intend to use. <code class="docutils literal"><span class="pre">TCP</span></code>? <code class="docutils literal"><span class="pre">UDP</span></code>? <code class="docutils literal"><span class="pre">ICMP</span></code>?
<code class="docutils literal"><span class="pre">IGMP</span></code>?</p>
</div>



<div class="slide-no">33</div>


    </article>
  </slide>  <slide class="level-3" id="id25">
    <hgroup>
      <h3>Test your skills</h3>
    </hgroup>
    <article class="">
      <p>What is the <em>default</em> protocol used by our generic socket, <code class="docutils literal"><span class="pre">foo</span></code>?</p>



<div class="slide-no">34</div>


    </article>
  </slide>  <slide class="level-3" id="customizing-sockets">
    <hgroup>
      <h3>Customizing Sockets</h3>
    </hgroup>
    <article class="">
      <p>These three properties of a socket correspond to the three positional
arguments you may pass to the socket constructor.</p>
<div class="build container">
<p>Using them allows you to create sockets with specific communications
profiles:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
<span class="gp">   ...: </span>              <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">,</span>
<span class="gp">   ...: </span>              <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_UDP</span><span class="p">)</span>
<span class="gh">Out[3]: </span><span class="go">&lt;socket.socket fd=7,</span>
<span class="go">            family=AddressFamily.AF_INET,</span>
<span class="go">            type=SocketKind.SOCK_DGRAM,</span>
<span class="go">            proto=17,</span>
<span class="go">            laddr=(&#39;0.0.0.0&#39;, 0)&gt;</span>
</pre></div>
</div>
</div>



<div class="slide-no">35</div>


    </article>
  </slide>  <slide class="level-3" id="break-time">
    <hgroup>
      <h3>Break Time</h3>
    </hgroup>
    <article class="">
      <p>So far we have:</p>
<div class="build container">
<ul class="build simple">
<li>learned about the &quot;layers&quot; of the TCP/IP Stack</li>
<li>discussed <em>families</em>, <em>types</em> and <em>protocols</em> in sockets</li>
<li>learned how to create sockets with a specific communications profile.</li>
</ul>
<p>When we return we'll learn how to find the communcations profiles of remote
sockets, how to connect to them, and how to send and receive messages.</p>
<p>Take a few minutes now to clear your head (do not quit your python
interpreter).</p>
</div>



<div class="slide-no">36</div>


    </article>
  </slide>  <slide class="level-3" id="address-information">
    <hgroup>
      <h3>Address Information</h3>
    </hgroup>
    <article class="">
      <p>When you are creating a socket to communicate with a remote service, the
remote socket will have a specific communications profile.</p>
<div class="build container">
<p>The local socket you create must match that communications profile.</p>
<p>How can you determine the <em>correct</em> values to use?</p>
<p class="centered"><strong>You ask.</strong></p>
</div>



<div class="slide-no">37</div>


    </article>
  </slide>  <slide class="level-3" id="id26">
    <hgroup>
      <h3>Address Information</h3>
    </hgroup>
    <article class="">
      <p>The function <code class="docutils literal"><span class="pre">socket.getaddrinfo</span></code> provides information about available
connections on a given host.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<div class="build container">
<p>This provides all you need to make a proper connection to a socket on a
remote host. The value returned is a tuple of:</p>
<ul class="build simple">
<li>socket family</li>
<li>socket type</li>
<li>socket protocol</li>
<li>canonical name (usually empty, unless requested by flag)</li>
<li>socket address (tuple of IP and Port)</li>
</ul>
</div>



<div class="slide-no">38</div>


    </article>
  </slide>  <slide class="level-3" id="id27">
    <hgroup>
      <h3>A quick utility method</h3>
    </hgroup>
    <article class="">
      <p>Again, let's create a utility method in-place so we can see this in action:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [10]: </span><span class="k">def</span> <span class="nf">get_address_info</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="gp">   ....: </span>        <span class="n">fam</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">pro</span><span class="p">,</span> <span class="n">nam</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">response</span>
<span class="gp">   ....: </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;family: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">families</span><span class="p">[</span><span class="n">fam</span><span class="p">]))</span>
<span class="gp">   ....: </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;type: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">types</span><span class="p">[</span><span class="n">typ</span><span class="p">]))</span>
<span class="gp">   ....: </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;protocol: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">protocols</span><span class="p">[</span><span class="n">pro</span><span class="p">]))</span>
<span class="gp">   ....: </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;canonical name: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nam</span><span class="p">))</span>
<span class="gp">   ....: </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;socket address: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">add</span><span class="p">))</span>
<span class="gp">   ....: </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="gp">   ....:</span>
</pre></div>
</div>
<p>(you can also find this in <code class="docutils literal"><span class="pre">resources/session01/socket_tools.py</span></code>)</p>



<div class="slide-no">39</div>


    </article>
  </slide>  <slide class="level-3" id="id28">
    <hgroup>
      <h3>On Your Own Machine</h3>
    </hgroup>
    <article class="">
      <p>Now, ask your own machine what possible connections are available for 'http':</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [11]: </span><span class="n">get_address_info</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span> <span class="s">&#39;http&#39;</span><span class="p">)</span>
<span class="go">family: AF_INET</span>
<span class="go">type: SOCK_DGRAM</span>
<span class="go">protocol: IPPROTO_UDP</span>
<span class="go">canonical name:</span>
<span class="go">socket address: (&#39;127.0.0.1&#39;, 80)</span>

<span class="go">family: AF_INET</span>
<span class="go">type: SOCK_STREAM</span>
<span class="go">protocol: IPPROTO_TCP</span>
<span class="go">canonical name:</span>
<span class="go">socket address: (&#39;127.0.0.1&#39;, 80)</span>
</pre></div>
</div>
<p>What answers do you get?</p>
</div>



<div class="slide-no">40</div>


    </article>
  </slide>  <slide class="level-3" id="id29">
    <hgroup>
      <h3>On the Internet</h3>
    </hgroup>
    <article class="">
      <div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [12]: </span><span class="n">get_address_info</span><span class="p">(</span><span class="s">&#39;crisewing.com&#39;</span><span class="p">,</span> <span class="s">&#39;http&#39;</span><span class="p">)</span>
<span class="go">family: AF_INET</span>
<span class="go">type: SOCK_DGRAM</span>
<span class="go">protocol: IPPROTO_UDP</span>
<span class="go">canonical name:</span>
<span class="go">socket address: (&#39;108.168.213.86&#39;, 80)</span>

<span class="go">family: AF_INET</span>
<span class="go">type: SOCK_STREAM</span>
<span class="go">protocol: IPPROTO_TCP</span>
<span class="go">canonical name:</span>
<span class="go">socket address: (&#39;108.168.213.86&#39;, 80)</span>
</pre></div>
</div>
<div class="build container">
Try a few other servers you know about.</div>



<div class="slide-no">41</div>


    </article>
  </slide>  <slide class="level-2" id="client-side">
    <hgroup>
      <h2>Client Side</h2>
    </hgroup>
    <article class="">
      <div class="build container">
<p class="large">Let's put this to use</p>
<p>We'll communicate with a remote server as a <em>client</em></p>
</div>



<div class="slide-no">42</div>


    </article>
  </slide>  <slide class="level-3" id="construct-a-socket">
    <hgroup>
      <h3>Construct a Socket</h3>
    </hgroup>
    <article class="">
      <p>We've already made a socket <code class="docutils literal"><span class="pre">foo</span></code> using the generic constructor without any
arguments.  We can make a better one now by using real address information from
a real server online [<strong>do not type this yet</strong>]:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [13]: </span><span class="n">streams</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span>
<span class="gp">   ....: </span>    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s">&#39;crisewing.com&#39;</span><span class="p">,</span> <span class="s">&#39;http&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">]</span>
<span class="gp">   ....:</span>
<span class="gp">In [14]: </span><span class="n">streams</span>
<span class="gh">Out[14]:</span>
<span class="go">[(&lt;AddressFamily.AF_INET: 2&gt;,</span>
<span class="go">  &lt;SocketKind.SOCK_STREAM: 1&gt;,</span>
<span class="go">  6,</span>
<span class="go">  &#39;&#39;,</span>
<span class="go">  (&#39;108.168.213.86&#39;, 80))]</span>
<span class="gp">In [15]: </span><span class="n">info</span> <span class="o">=</span> <span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">In [16]: </span><span class="n">cewing_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="o">*</span><span class="n">info</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>



<div class="slide-no">43</div>


    </article>
  </slide>  <slide class="level-3" id="connecting-a-socket">
    <hgroup>
      <h3>Connecting a Socket</h3>
    </hgroup>
    <article class="">
      <p>Once the socket is constructed with the appropriate <em>family</em>, <em>type</em> and
<em>protocol</em>, we can connect it to the address of our remote server:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [18]: </span><span class="n">cewing_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<ul class="build simple">
<li>a successful connection returns <code class="docutils literal"><span class="pre">None</span></code></li>
<li>a failed connection raises an error</li>
<li>you can use the <em>type</em> of error returned to tell why the connection failed.</li>
</ul>



<div class="slide-no">44</div>


    </article>
  </slide>  <slide class="level-3" id="sending-a-message">
    <hgroup>
      <h3>Sending a Message</h3>
    </hgroup>
    <article class="">
      <p>Send a message to the server on the other end of our connection (we'll
learn in session 2 about the message we are sending):</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [19]: </span><span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s">&quot;</span>
<span class="gp">In [20]: </span><span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;Host: crisewing.com</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span>
<span class="gp">In [21]: </span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
<span class="gp">In [22]: </span><span class="n">msg</span>
<span class="gh">Out[22]: </span><span class="go">b&#39;GET / HTTP/1.1\r\nHost: crisewing.com\r\n\r\n&#39;</span>
<span class="gp">In [23]: </span><span class="n">cewing_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<ul class="build small simple">
<li>the transmission continues until all data is sent or an error occurs</li>
<li>success returns <code class="docutils literal"><span class="pre">None</span></code></li>
<li>failure to send raises an error</li>
<li>the type of error can tell you why the transmission failed</li>
<li>but you <strong>cannot</strong> know how much, if any, of your data was sent</li>
</ul>



<div class="slide-no">45</div>


    </article>
  </slide>  <slide class="level-3" id="messages-are-bytes">
    <hgroup>
      <h3>Messages Are Bytes</h3>
    </hgroup>
    <article class="">
      <p>One detail from the previous code should stand out:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [21]: </span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
<span class="gp">In [22]: </span><span class="n">msg</span>
<span class="gh">Out[22]: </span><span class="go">b&#39;GET / HTTP/1.1\r\nHost: crisewing.com\r\n\r\n&#39;</span>
</pre></div>
</div>
<p>You can <strong>only</strong> send bytes through a socket, <strong>never</strong> unicode</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [35]: </span><span class="n">cewing_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-35-8178ec7f234d&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cewing_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>

<span class="ne">TypeError</span>: &#39;str&#39; does not support the buffer interface
</pre></div>
</div>



<div class="slide-no">46</div>


    </article>
  </slide>  <slide class="level-3" id="receiving-a-reply">
    <hgroup>
      <h3>Receiving a Reply</h3>
    </hgroup>
    <article class="">
      <p>Whatever reply we get is received by the socket we created. We can read it
back out (again, <strong>do not type this yet</strong>):</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [24]: </span><span class="n">response</span> <span class="o">=</span> <span class="n">cewing_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
<span class="gp">In [25]: </span><span class="n">response</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>
<span class="gh">Out[25]: </span><span class="go">b&#39;HTTP/1.1 200 OK\r\nServer: nginx\r\nDate: Sun, 20 Sep 2015 03:38&#39;</span>
</pre></div>
</div>
<ul class="build simple">
<li>The sole required argument is <code class="docutils literal"><span class="pre">buffer_size</span></code> (an integer). It should be a
power of 2 and smallish (~4096)</li>
<li>It returns a byte string of <code class="docutils literal"><span class="pre">buffer_size</span></code> (or smaller if less data was
received)</li>
<li>If the response is longer than <code class="docutils literal"><span class="pre">buffer</span> <span class="pre">size</span></code>, you can call the method
repeatedly. The last bunch will be less than <code class="docutils literal"><span class="pre">buffer</span> <span class="pre">size</span></code>.</li>
</ul>



<div class="slide-no">47</div>


    </article>
  </slide>  <slide class="level-3" id="cleaning-up">
    <hgroup>
      <h3>Cleaning Up</h3>
    </hgroup>
    <article class="">
      <p>When you are finished with a connection, you should always close it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cewing_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>



<div class="slide-no">48</div>


    </article>
  </slide>  <slide class="level-3" id="putting-it-all-together">
    <hgroup>
      <h3>Putting it all together</h3>
    </hgroup>
    <article class="">
      <p>First, connect and send a message:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [55]: </span><span class="n">info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s">&#39;crisewing.com&#39;</span><span class="p">,</span> <span class="s">&#39;http&#39;</span><span class="p">)</span>
<span class="gp">In [56]: </span><span class="n">streams</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">info</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">]</span>
<span class="gp">In [57]: </span><span class="n">sock_info</span> <span class="o">=</span> <span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">In [58]: </span><span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s">&quot;</span>
<span class="gp">In [59]: </span><span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;Host: crisewing.com</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span>
<span class="gp">In [60]: </span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
<span class="gp">In [61]: </span><span class="n">cewing_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="o">*</span><span class="n">sock_info</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">In [62]: </span><span class="n">cewing_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">sock_info</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">In [63]: </span><span class="n">cewing_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>



<div class="slide-no">49</div>


    </article>
  </slide>  <slide class="level-3" id="id30">
    <hgroup>
      <h3>Putting it all together</h3>
    </hgroup>
    <article class="">
      <p>Then, receive a reply, iterating until it is complete:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [65]: </span><span class="n">buffsize</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="gp">In [66]: </span><span class="n">response</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
<span class="gp">In [67]: </span><span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">In [68]: </span><span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">msg_part</span> <span class="o">=</span> <span class="n">cewing_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffsize</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg_part</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">buffsize</span><span class="p">:</span>
<span class="gp">   ....: </span>        <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">   ....: </span>        <span class="n">cewing_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">   ....: </span>    <span class="n">response</span> <span class="o">+=</span> <span class="n">msg_part</span>
<span class="gp">   ....:</span>
<span class="gp">In [69]: </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="gh">Out[69]: </span><span class="go">19464</span>
</pre></div>
</div>



<div class="slide-no">50</div>


    </article>
  </slide>  <slide class="level-2" id="server-side">
    <hgroup>
      <h2>Server Side</h2>
    </hgroup>
    <article class="">
      <div class="build container">
<p class="large">What about the other half of the equation?</p>
<p>Let's build a server and see how that part works.</p>
</div>



<div class="slide-no">51</div>


    </article>
  </slide>  <slide class="level-3" id="id1">
    <hgroup>
      <h3>Construct a Socket</h3>
    </hgroup>
    <article class="">
      <p><strong>For the moment, stop typing this into your interpreter.</strong></p>
<div class="build container">
<p>Again, we begin by constructing a socket. Since we are actually the server
this time, we get to choose family, type and protocol:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [70]: </span><span class="n">server_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_TCP</span><span class="p">)</span>

<span class="gp">In [71]: </span><span class="n">server_socket</span>
<span class="gh">Out[71]: </span><span class="go">&lt;socket.socket fd=12, family=AddressFamily.AF_INET,</span>
<span class="go">            type=SocketKind.SOCK_STREAM, proto=6, laddr=(&#39;0.0.0.0&#39;, 0)&gt;</span>
</pre></div>
</div>
</div>



<div class="slide-no">52</div>


    </article>
  </slide>  <slide class="level-3" id="bind-the-socket">
    <hgroup>
      <h3>Bind the Socket</h3>
    </hgroup>
    <article class="">
      <p>Our server socket needs to be <strong>bound</strong> to an address. This is the IP Address
and Port to which clients must connect:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [72]: </span><span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>
<span class="gp">In [73]: </span><span class="n">server_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Terminology Note</strong>: In a server/client relationship, the server <em>binds</em>
to an address and port. The client <em>connects</em></p>
</div>



<div class="slide-no">53</div>


    </article>
  </slide>  <slide class="level-3" id="listen-for-connections">
    <hgroup>
      <h3>Listen for Connections</h3>
    </hgroup>
    <article class="">
      <p>Once our socket is bound to an address, we can listen for attempted
connections:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [74]: </span><span class="n">server_socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<ul class="build simple">
<li>The argument to <code class="docutils literal"><span class="pre">listen</span></code> is the <em>backlog</em></li>
<li>The <em>backlog</em> is the <strong>maximum</strong> number of connection requests that the
socket will queue</li>
<li>Once the limit is reached, the socket refuses new connections.</li>
</ul>



<div class="slide-no">54</div>


    </article>
  </slide>  <slide class="level-3" id="accept-a-connection">
    <hgroup>
      <h3>Accept A Connection</h3>
    </hgroup>
    <article class="">
      <p>When a socket is listening, it can receive incoming connection requests:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [75]: </span><span class="n">connection</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="n">server_socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</pre></div>
</div>
<ul class="build simple">
<li>The call to <code class="docutils literal"><span class="pre">socket.accept()</span></code> is a <em>blocking</em> call.  It will not return
values until a client <em>connects</em></li>
<li>The <code class="docutils literal"><span class="pre">connection</span></code> returned by a call to <code class="docutils literal"><span class="pre">accept</span></code> is a <strong>new socket</strong>.
This new socket is used to communicate with the client</li>
<li>The <code class="docutils literal"><span class="pre">client_address</span></code> is a two-tuple of IP Address and Port for the client
socket</li>
<li>When a connection request is 'accepted', it is removed from the backlog
queue.</li>
</ul>



<div class="slide-no">55</div>


    </article>
  </slide>  <slide class="level-3" id="communicate">
    <hgroup>
      <h3>Communicate</h3>
    </hgroup>
    <article class="">
      <p>The <code class="docutils literal"><span class="pre">connection</span></code> socket can now be used to receive messages from the client
which made the connection:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [76]: </span><span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffsize</span><span class="p">)</span>
</pre></div>
</div>
<p>It may also be used to return a reply:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [77]: </span><span class="n">connection</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s">&quot;message received&quot;</span><span class="p">)</span>
</pre></div>
</div>



<div class="slide-no">56</div>


    </article>
  </slide>  <slide class="level-3" id="clean-up">
    <hgroup>
      <h3>Clean Up</h3>
    </hgroup>
    <article class="">
      <p>Once a transaction between the client and server is complete, the
<code class="docutils literal"><span class="pre">connection</span></code> socket should be closed:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [78]: </span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>At this point, the <code class="docutils literal"><span class="pre">server_socket</span></code> can again accept a new client
connection.</p>
<p>Note that the <code class="docutils literal"><span class="pre">server_socket</span></code> is <em>never</em> closed as long as the server
continues to run.</p>
</div>



<div class="slide-no">57</div>


    </article>
  </slide>  <slide class="level-2" id="getting-the-flow">
    <hgroup>
      <h2>Getting the Flow</h2>
    </hgroup>
    <article class="">
      <div class="left container">
<p>The flow of this interaction can be a bit confusing.  Let's see it in
action step-by-step.</p>
<div class="build container">
<div class="container">
Open a second iPython interpreter and place it next to your first so
you can see both of them at the same time.</div>
</div>
</div>



<div class="slide-no">58</div>


    </article>
  </slide>  <slide class="level-3" id="create-a-server">
    <hgroup>
      <h3>Create a Server</h3>
    </hgroup>
    <article class="">
      <p>In your first python interpreter, create a server socket and prepare it for
connections:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [81]: </span><span class="n">server_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_IP</span><span class="p">)</span>
<span class="gp">In [82]: </span><span class="n">server_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">))</span>
<span class="gp">In [83]: </span><span class="n">server_socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">In [84]: </span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">server_socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</pre></div>
</div>
<p>At this point, you should <strong>not</strong> get back a prompt. The server socket is
waiting for a connection to be made.</p>
</div>



<div class="slide-no">59</div>


    </article>
  </slide>  <slide class="level-3" id="create-a-client">
    <hgroup>
      <h3>Create a Client</h3>
    </hgroup>
    <article class="">
      <p>In your second interpreter, create a client socket and prepare to send a
message:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">socket</span>
<span class="gp">In [2]: </span><span class="n">client_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span>
<span class="gp">   ...: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_IP</span><span class="p">)</span>
</pre></div>
</div>
<p>Before connecting, keep your eye on the server interpreter:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="n">client_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">))</span>
</pre></div>
</div>
</div>



<div class="slide-no">60</div>


    </article>
  </slide>  <slide class="level-3" id="send-a-message-client-server">
    <hgroup>
      <h3>Send a Message Client-&gt;Server</h3>
    </hgroup>
    <article class="">
      <p>As soon as you made the connection above, you should have seen the prompt
return in your server interpreter. The <code class="docutils literal"><span class="pre">accept</span></code> method finally returned a
new connection socket.</p>
<div class="build container">
<p>When you're ready, type the following in the <em>client</em> interpreter:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="n">client_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s">&#39;Hey, can you hear me?&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>



<div class="slide-no">61</div>


    </article>
  </slide>  <slide class="level-3" id="receive-and-respond">
    <hgroup>
      <h3>Receive and Respond</h3>
    </hgroup>
    <article class="">
      <p>Back in your server interpreter, go ahead and receive the message from your
client:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [87]: </span><span class="n">msg</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
<span class="gp">In [88]: </span><span class="n">msg</span>
<span class="gh">Out[88]: </span><span class="go">b&#39;Hey, can you hear me?&#39;</span>
</pre></div>
</div>
<p>Send a message back, and then close up your connection:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [89]: </span><span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s">&#39;Yes, I can hear you.&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>
<span class="gp">In [90]: </span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>



<div class="slide-no">62</div>


    </article>
  </slide>  <slide class="level-3" id="finish-up">
    <hgroup>
      <h3>Finish Up</h3>
    </hgroup>
    <article class="">
      <p>Back in your client interpreter, take a look at the response to your message,
then be sure to close your client socket too:</p>
<div class="build container">
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [5]: </span><span class="n">from_server</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
<span class="gp">In [6]: </span><span class="n">from_server</span>
<span class="gh">Out[6]: </span><span class="go">b&#39;Yes, I can hear you.&#39;</span>
<span class="gp">In [7]: </span><span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>And now that we're done, we can close up the server socket too (back in the
server interpreter):</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [91]: </span><span class="n">server_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>



<div class="slide-no">63</div>


    </article>
  </slide>  <slide class="level-3" id="id31">
    <hgroup>
      <h3>Congratulations!</h3>
    </hgroup>
    <article class="">
      <p class="large center">You've run your first client-server interaction</p>



<div class="slide-no">64</div>


    </article>
  </slide>  <slide class="level-2" id="homework">
    <hgroup>
      <h2>Homework</h2>
    </hgroup>
    <article class="">
      <div class="left container">
<p>Your homework assignment for this week is to take what you've learned here
and build a simple &quot;echo&quot; server.</p>
<div class="build container">
<p>The server should automatically return to any client that connects <em>exactly</em>
what it receives (it should <strong>echo</strong> all messages).</p>
<p>You will also write a python script that, when run, will send a message to the
server and receive the reply, printing it to <code class="docutils literal"><span class="pre">stdout</span></code>.</p>
<p>Finally, you'll do all of this so that it can be tested.</p>
</div>
</div>



<div class="slide-no">65</div>


    </article>
  </slide>  <slide class="level-3" id="your-task">
    <hgroup>
      <h3>Your Task</h3>
    </hgroup>
    <article class="">
      <p>In our class repository, there is a folder <code class="docutils literal"><span class="pre">resources/session01</span></code>.</p>
<div class="build container">
<p>Inside that folder, you should find:</p>
<ul class="build simple">
<li>A file <code class="docutils literal"><span class="pre">tasks.txt</span></code> that contains these instructions</li>
<li>A skeleton for your server in <code class="docutils literal"><span class="pre">echo_server.py</span></code></li>
<li>A skeleton for your client script in <code class="docutils literal"><span class="pre">echo_client.py</span></code></li>
<li>Some simple tests in <code class="docutils literal"><span class="pre">tests.py</span></code></li>
</ul>
<p>Your task is to make the tests pass.</p>
</div>



<div class="slide-no">66</div>


    </article>
  </slide>  <slide class="level-3" id="running-the-tests">
    <hgroup>
      <h3>Running the Tests</h3>
    </hgroup>
    <article class="">
      <p>To run the tests, you'll have to set the server running in one terminal:</p>
<div class="build container">
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python echo_server.py
</pre></div>
</div>
<p>Then, in a second terminal, you will execute the tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python tests.py
</pre></div>
</div>
<p>You should see output like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>...<span class="o">]</span>
FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>2<span class="o">)</span>
</pre></div>
</div>
</div>



<div class="slide-no">67</div>


    </article>
  </slide>  <slide class="level-3" id="submitting-your-homework">
    <hgroup>
      <h3>Submitting Your Homework</h3>
    </hgroup>
    <article class="">
      <p>To submit your homework:</p>
<div class="build container">
<ul class="build simple">
<li>Create a new repository in GitHub.  Call it <code class="docutils literal"><span class="pre">echo_sockets</span></code>.</li>
<li>Put the <code class="docutils literal"><span class="pre">echo_server.py</span></code>, <code class="docutils literal"><span class="pre">echo_client.py</span></code> and <code class="docutils literal"><span class="pre">tests.py</span></code> files in
this repository.</li>
<li>Send us an email with a link to your repository when you are
done.</li>
</ul>
<p>We will clone your repository and run the tests as described above.</p>
<p>And we'll make comments inline on your repository.</p>
</div>



<div class="slide-no">68</div>


    </article>
  </slide>  <slide class="level-3" id="going-further">
    <hgroup>
      <h3>Going Further</h3>
    </hgroup>
    <article class="">
      <p>In <code class="docutils literal"><span class="pre">assignments/session01/tasks.txt</span></code> you'll find a few extra problems to try.</p>
<div class="build container">
<p>If you finish the first part of the homework in less than 3-4 hours give
one or more of these a whirl.</p>
<p>They are not required, but if you include solutions in your repository,
we'll review your work.</p>
</div>



<div class="slide-no">69</div>


    </article>
  </slide>


    <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="../_static/logo_UW.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>Good Night!</h2>
      <p>&nbsp;</p>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>