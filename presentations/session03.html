<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Python Web Programming</title>
<link rel="stylesheet" href="ui/uw_pce_theme/pretty.css" type="text/css" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/uw_pce_theme/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/uw_pce_theme/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/uw_pce_theme/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/uw_pce_theme/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/uw_pce_theme/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Python Web Programming</h1>
<h2><a class="reference external" href="http://github.com/cewing/training.python_web">View document source</a>.
</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Python Web Programming</h1>

<img alt="img/granny_mashup.png" class="align-left" src="img/granny_mashup.png" style="width: 50%;" />
<p>Session 3: Scraping, APIs and Mashups</p>
<p class="intro-blurb">Wherein we learn how to make order from the chaos of the wild internet.</p>
<p class="image-credit">image: Paul Downey <a class="reference external" href="http://www.flickr.com/photos/psd/492139935/">http://www.flickr.com/photos/psd/492139935/</a> - CC-BY</p>

</div>
<div class="slide" id="a-dilemma">
<h1>A Dilemma</h1>
<p>The internet makes a vast quantity of data available.</p>
<p class="incremental">But not always in the form or combination you want.</p>
<p class="incremental">It would be nice to be able to combine data from different source to create
<em>meaning</em>.</p>
</div>
<div class="slide" id="the-big-question">
<h1>The Big Question</h1>
<p class="big-centered">But How?</p>
</div>
<div class="slide" id="the-big-answer">
<h1>The Big Answer</h1>
<p class="big-centered">Mashups</p>
</div>
<div class="slide" id="mashups">
<h1>Mashups</h1>
<p>A mashup is:</p>
<blockquote>
a web page, or web application, that uses and combines data, presentation
or functionality from two or more sources to create new services.</blockquote>
<p class="image-credit">definition courtsey of <a class="reference external" href="http://en.wikipedia.org/wiki/Mashup_(web_application_hybrid)">wikipedia</a></p>
</div>
<div class="slide" id="data-sources">
<h1>Data Sources</h1>
<p>The key to mashups is the idea of data sources.</p>
<p class="incremental">These come in many flavors:</p>
<ul class="incremental simple">
<li>Simple websites with data in HTML</li>
<li>Web services providing structured data</li>
<li>Web services providing tranformative service (geocoding)</li>
<li>Web services providing presentation (mapping)</li>
</ul>
</div>
<div class="slide" id="html-sources">
<h1>HTML Sources</h1>
<p>It would be nice if all online data were available in well-structured formats.</p>
<p class="incremental">The reality is that much data is available only in HTML.</p>
<p class="incremental">Still we can get at it, with some effort.</p>
<p class="incremental">By scraping the data from the web pages.</p>
</div>
<div class="slide" id="html-ideally">
<h1>HTML, Ideally</h1>
<pre class="literal-block">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;A nice clean paragraph&lt;/p&gt;
    &lt;p&gt;And another nice clean paragraph&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
<div class="slide" id="html-irl">
<h1>HTML... IRL</h1>
<pre class="literal-block">
&lt;html&gt;
 &lt;form&gt;
  &lt;table&gt;
   &lt;td&gt;&lt;input name=&quot;input1&quot;&gt;Row 1 cell 1
   &lt;tr&gt;&lt;td&gt;Row 2 cell 1
  &lt;/form&gt;
  &lt;td&gt;Row 2 cell 2&lt;br&gt;This&lt;/br&gt; sure is a long cell
 &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
<div class="slide" id="fffffffffuuuuuuuuuuuuu">
<h1>FFFFFFFFFUUUUUUUUUUUUU</h1>
<img alt="img/scream.jpg" class="align-center" src="img/scream.jpg" style="width: 32%;" />
<p class="image-credit">Photo by Matthew via Flickr (<a class="reference external" href="http://www.flickr.com/photos/purplemattfish/3918004964/">http://www.flickr.com/photos/purplemattfish/3918004964/</a>) - CC-BY-NC-ND</p>
</div>
<div class="slide" id="the-law-of-the-internet">
<h1>The Law of The Internet</h1>
<p class="big-centered">&quot;Be strict in what you send and tolerant in what you receive&quot;</p>
</div>
<div class="slide" id="taming-the-mess">
<h1>Taming the Mess</h1>
<p>Luckily, there's a tool to help with this:  <tt class="docutils literal">BeautifulSoup</tt>.</p>
<p class="incremental">BeautifulSoup is a great tool, but it's not in the Standard Library. We'll
need to install it.</p>
<ul class="incremental simple">
<li>As a real-world developer you need to do this a lot</li>
<li>As a web developer you need to install <em>different</em> versions of the <em>same</em>
library</li>
<li>For every non-standard library installed into a System Python, the gods kill
a kitten</li>
<li>Use Virtualenv...</li>
<li><strong>Always</strong></li>
</ul>
</div>
<div class="slide" id="getting-virtualenv">
<h1>Getting Virtualenv</h1>
<p>Three options for installing virtualenv (this is the exception to the above
rule):</p>
<ul class="incremental simple">
<li><tt class="docutils literal">pip install virtualenv</tt></li>
<li><tt class="docutils literal">easy_install virtualenv</tt></li>
</ul>
<p class="incremental">These both demand that you have already got <tt class="docutils literal">pip</tt> or <tt class="docutils literal">easy_install</tt>. If
you haven't, try this way instead:</p>
<ul class="incremental simple">
<li>download <tt class="docutils literal"><span class="pre">https://raw.github.com/pypa/virtualenv/master/virtualenv.py</span></tt></li>
<li>remember where it goes.  You'll need it</li>
</ul>
</div>
<div class="slide" id="creating-a-virtualenv">
<h1>Creating a Virtualenv</h1>
<p>Creating a new virtualenv is very very simple:</p>
<pre class="small literal-block">
$ python virtualenv.py [options] &lt;ENV&gt;
&lt;or&gt;
$ virtualenv [options] &lt;ENV&gt;
</pre>
<div class="incremental small container">
<p>&lt;ENV&gt; is just the name of the environment you want to create. It's
arbitrary. Let's make one for our BeautifulSoup install:</p>
<pre class="literal-block">
$ python virtualenv.py soupenv
New python executable in soupenv/bin/python2.6
New python executable in soupenv/bin/python
Installing setuptools........................done.
Installing pip...................done.
</pre>
</div>
</div>
<div class="slide" id="what-happened">
<h1>What Happened?</h1>
<p>When you ran that file, a couple of things took place:</p>
<ul class="incremental simple">
<li>A new directory with your requested name was created</li>
<li>A new Python executable was created in &lt;ENV&gt;/bin (&lt;ENV&gt;/Scripts on Windows)</li>
<li>The new Python was cloned from the Python used to run the file</li>
<li>The new Python was isolated from any libraries installed in the old Python</li>
<li>Setuptools was installed so you have <tt class="docutils literal">easy_install</tt> for this new python</li>
<li>Pip was installed so you have <tt class="docutils literal">pip</tt> for this new python</li>
</ul>
<p class="incremental">Cool, eh?  Learn more at <a class="reference external" href="http://www.virtualenv.org">http://www.virtualenv.org</a></p>
</div>
<div class="slide" id="using-virtualenv">
<h1>Using Virtualenv</h1>
<p>To install new libraries into a virtualenv, first activate the env:</p>
<pre class="literal-block">
$ source soupenv/bin/activate
(soupenv)$ which python
/path/to/soupenv/bin/python
</pre>
<p>Or, on Windows:</p>
<pre class="literal-block">
&gt; \path\to\soupenv\Scripts\activate
</pre>
<p class="image-credit">If you use Powershell, read the note here:
<a class="reference external" href="http://www.virtualenv.org/en/latest/#activate-script">http://www.virtualenv.org/en/latest/#activate-script</a></p>
</div>
<div class="slide" id="install-beautifulsoup">
<h1>Install BeautifulSoup</h1>
<p>Once the virtualenv is activated, you can simply use pip or easy_install to
install the libraries you want:</p>
<pre class="literal-block">
(soupenv)$ pip install beautifulsoup4
</pre>
</div>
<div class="slide" id="choose-a-parsing-engine">
<h1>Choose a Parsing Engine</h1>
<p>BeautifulSoup is built to use the Python HTMLParser.</p>
<ul class="incremental simple">
<li>Batteries Included.  It's already there</li>
<li>It kinda sucks, especially before Python 2.7.3</li>
</ul>
<p class="incremental">BeautifulSoup also supports using other parsers. Let's install one. There are
two decent choices: <tt class="docutils literal">lxml</tt> and <tt class="docutils literal">html5lib</tt>.</p>
<p class="incremental"><tt class="docutils literal">lxml</tt> is better, but harder to install.  Let's use <tt class="docutils literal">html5lib</tt> today.</p>
</div>
<div class="slide" id="install-a-parsing-engine">
<h1>Install a Parsing Engine</h1>
<p>Again, this is pretty simple:</p>
<pre class="literal-block">
(soupenv)$ pip install html5lib
</pre>
<p class="incremental">Once that is installed, BeautifulSoup will choose it instead of the standard
library module.</p>
<p class="incremental">BeautifulSoup will choose the best available, you don't need to worry about it
(though you can specify).</p>
</div>
<div class="slide" id="install-requests">
<h1>Install Requests</h1>
<p>Python provides tools for opening urls and communicating with servers. It's
spread across the <tt class="docutils literal">urllib</tt> and <tt class="docutils literal">urllib2</tt> packages.</p>
<p class="incremental">These packages have pretty unintuitive APIs.</p>
<p class="incremental">The <tt class="docutils literal">requests</tt> library is becoming the de-facto standard for this type of
work.  Let's install it too.</p>
<pre class="incremental literal-block">
(soupenv)$ pip install requests
</pre>
</div>
<div class="slide" id="our-class-mashup">
<h1>Our Class Mashup</h1>
<p>We're going to build a mashup together today.</p>
<p class="incremental">It will give us an annotated list of apartment rentals, so the next time we
have to move, we can find the exact right place.</p>
<p class="incremental">We'll start by getting a raw list of apartment rentals from today's canonical
source:</p>
<p class="incremental">Craigslist</p>
<p class="incremental">Open a new file in your editor: <tt class="docutils literal">mashup.py</tt>.</p>
</div>
<div class="slide" id="examine-the-source">
<h1>Examine the Source</h1>
<p>Craigslist doesn't have an api, just a website, so we'll need to dig a bit</p>
<p class="incremental">By going to the website and playing with the form there, we can derive a
formula for a search URL</p>
<ul class="incremental simple">
<li>Base URL: <tt class="docutils literal"><span class="pre">http://raleigh.craigslist.org/search/apa</span></tt></li>
<li>keywords: <tt class="docutils literal">query=keyword+values+here</tt></li>
<li>price: <tt class="docutils literal">minAsk=NNN maxAsk=NNN</tt></li>
<li>bedrooms: <tt class="docutils literal">bedrooms=N</tt> (N in range 1-8)</li>
</ul>
<p class="incremental">We can make a request with these parameters using the <tt class="docutils literal">requests</tt> library we
installed a moment ago</p>
</div>
<div class="slide" id="opening-urls-with-requests">
<h1>Opening URLs with Requests</h1>
<p>Requests has a very nice API for doing HTTP requests.</p>
<p class="incremental">Each HTTP method is represented by a module-level function:</p>
<ul class="incremental simple">
<li><tt class="docutils literal">GET</tt> == <tt class="docutils literal">requests.get(url, **kwargs)</tt></li>
<li><tt class="docutils literal">POST</tt> == <tt class="docutils literal">requests.post(url, **kwargs)</tt></li>
<li>...</li>
</ul>
<p class="incremental">Keyword arguments allow for other parts of an HTTP request:</p>
<ul class="incremental simple">
<li><tt class="docutils literal">params</tt>: url parameters (?foo=bar&amp;baz=bim)</li>
<li><tt class="docutils literal">headers</tt>: headers to send with the request</li>
<li><tt class="docutils literal">data</tt>: the body of the request, if any (form data for POST goes here)</li>
<li>...</li>
</ul>
</div>
<div class="slide" id="getting-responses-with-requests">
<h1>Getting Responses with Requests</h1>
<p>Once you've made a request using one of these methods, the return value is a
<tt class="docutils literal">response</tt>.</p>
<p class="incremental">This object has a number of useful attributes:</p>
<ul class="incremental simple">
<li><tt class="docutils literal">response.status_code</tt>: see the HTTP Status Code returned</li>
<li><tt class="docutils literal">response.ok</tt>: True if <tt class="docutils literal">response.status_code</tt> is not an error code</li>
<li><tt class="docutils literal">response.headers</tt>: The headers sent in the response from the server</li>
<li><tt class="docutils literal">response.text</tt>: Body of the response, decoded to a unicode string</li>
<li><tt class="docutils literal">response.encoding</tt>: The encoding used to decode <tt class="docutils literal">response.text</tt></li>
<li><tt class="docutils literal">response.content</tt>: The original response body, not decoded (useful for
binary content)</li>
</ul>
<p class="incremental">If an error status is returned, you can raise a Python error by calling
<tt class="docutils literal">response.raise_for_status</tt>.</p>
</div>
<div class="slide" id="fetch-search-results">
<h1>Fetch Search Results</h1>
<p>We can start our work by writing a function <tt class="docutils literal">fetch_search_results</tt></p>
<ul class="incremental simple">
<li>It will accept one keyword argument for each of the possible query values</li>
<li>It will build a dictionary of request query parameters from incoming keywords</li>
<li>It will make a request to the craigslist server using this query</li>
<li>It will return the body of the response if there is no error</li>
<li>It will raise an error if there is a problem with the response</li>
</ul>
<p class="incremental">Using what you've learned, take a stab at writing this function. Put it in
<tt class="docutils literal">mashup.py</tt></p>
</div>
<div class="slide" id="my-solution">
<h1>My Solution</h1>
<p>Here's the one I created:</p>
<pre class="code python small incremental literal-block">
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">fetch_search_results</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">base</span> <span class="o">=</span> <span class="s">'http://raleigh.craigslist.org/search/apa'</span>
    <span class="n">valid_kws</span> <span class="o">=</span> <span class="p">(</span><span class="s">'query'</span><span class="p">,</span> <span class="s">'minAsk'</span><span class="p">,</span> <span class="s">'maxAsk'</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">)</span>
    <span class="n">use_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">valid_kws</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No valid keywords&quot;</span><span class="p">)</span>

    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">use_kwargs</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">encoding</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</pre>
</div>
<div class="slide" id="parse-the-results">
<h1>Parse the Results</h1>
<p>Next, we need a function <tt class="docutils literal">parse_source</tt> to set up HTML for scraping. It will
need to:</p>
<ul class="incremental simple">
<li>Take the response body from the previous method (or some other source)</li>
<li>Parse it using BeautifulSoup</li>
<li>Return the parsed object for further processing</li>
</ul>
<p class="incremental">Before you start, a word about parsing HTML with BeautifulSoup</p>
</div>
<div class="slide" id="parsing-html-with-beautifulsoup">
<h1>Parsing HTML with BeautifulSoup</h1>
<p>The BeautifulSoup object can be instantiated with a string or a file-like
object as the sole argument:</p>
<pre class="code python small literal-block">
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;h1&gt;Some HTML&lt;/h1&gt;'</span><span class="p">)</span>

<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'a_page.html'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">'http://site.com/page.html'</span><span class="p">)</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</pre>
<p class="incremental">You might want to open the documentation as reference
(<a class="reference external" href="http://www.crummy.com/software/BeautifulSoup/bs4/doc">http://www.crummy.com/software/BeautifulSoup/bs4/doc</a>)</p>
</div>
<div class="slide" id="id1">
<h1>My Solution</h1>
<p>Take a shot at writing this new function in <tt class="docutils literal">mashup.py</tt></p>
<pre class="code python incremental small literal-block">
<span class="c"># add this import at the top</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c"># then add this function lower down</span>
<span class="k">def</span> <span class="nf">parse_source</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">):</span>
    <span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">from_encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parsed</span>
</pre>
</div>
<div class="slide" id="put-it-together">
<h1>Put It Together</h1>
<p>To see how we're doing, we'll need to make our script do something when run.</p>
<p class="incremental">Add an <tt class="docutils literal">if __name__ == '__main__`:</tt> block to the bottom of our library</p>
<ul class="incremental simple">
<li>Fetch a search results page</li>
<li>Parse the resulting HTML</li>
<li>For now, print out the results so we can see what we get</li>
</ul>
<div class="incremental small container">
<p>You can print nice-looking output with BeautifulSoup:</p>
<pre class="literal-block">
print parsed.prettify()
</pre>
</div>
</div>
<div class="slide" id="id2">
<h1>My Solution</h1>
<p>Try to come up with the proper code on your own.  Add it to <tt class="docutils literal">mashup.py</tt></p>
<pre class="code python incremental literal-block">
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'minAsk'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">'maxAsk'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">html</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">fetch_search_results</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">parse_source</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">doc</span><span class="o">.</span><span class="n">prettify</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="test-your-work">
<h1>Test Your Work</h1>
<p>Assuming your virtualenv is still active, you should be able to execute the
script.</p>
<pre class="incremental small literal-block">
(soupenv)$ python mashup.py
&lt;!DOCTYPE html&gt;
&lt;html class=&quot;nojs&quot;&gt;
 &lt;head&gt;
  &lt;title&gt;
   raleigh apts/housing for rent classifieds  - craigslist
  &lt;/title&gt;
...
</pre>
<div class="incremental container">
<p>Try it again, this time redirect the output to a local file, so we can use
it without needing to hit the craiglist servers each time:</p>
<pre class="small literal-block">
(soupenv)$ python mashup.py &gt; craigslist_results.html
</pre>
</div>
</div>
<div class="slide" id="finding-the-needle">
<h1>Finding The Needle</h1>
<p>The next step is to find the bits of this pile of HTML that matter to us.</p>
<p class="incremental">We've got this HTML file, so let's open it in a browser and take a look</p>
<p class="incremental">We'll want to find:</p>
<ul class="incremental simple">
<li>The HTML element that contains a single listing</li>
<li>The source of location data, listings without location should be abandoned</li>
<li>The description of a listing</li>
<li>The link to a full listing page on craigslist</li>
<li>Relevant price or size data.</li>
</ul>
</div>
<div class="slide" id="pulling-it-out">
<h1>Pulling it Out</h1>
<p>Now that we know what we are looking for, we can extract it. In BeautifulSoup:</p>
<ul class="incremental simple">
<li>All HTML elements (including the parsed document itself) act like <tt class="docutils literal">tags</tt></li>
<li>A <tt class="docutils literal">tag</tt> can be searched using the <tt class="docutils literal">find_all</tt> method</li>
<li>The <tt class="docutils literal">find_all</tt> method searches the descendents of the tag on which it is
called.</li>
<li>The <tt class="docutils literal">find_all</tt> method takes arguments which act as <em>filters</em> on the search
results</li>
</ul>
<div class="incremental line-block">
<div class="line">like so:</div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">tag.find_all(name, attrs, recursive, text, limit, **kwargs)</tt></div>
</div>
</div>
<div class="slide" id="searching-by-css-class">
<h1>Searching by CSS Class</h1>
<p>The items we are looking for are <tt class="docutils literal">p</tt> tags which have the CSS class
<tt class="docutils literal">row</tt>:</p>
<p class="incremental"><tt class="docutils literal">find_all</tt> supports keyword arguments. If the keyword you use isn't one of
the listed arguments, it is treated as an <tt class="docutils literal">attribute</tt></p>
<p class="incremental">In Python, <tt class="docutils literal">class</tt> is a reserved word, so we can't use it as a keyword, but
you can use <tt class="docutils literal">class_</tt>!</p>
<pre class="incremental small literal-block">
parsed.find_all('p', class_='row')
</pre>
</div>
<div class="slide" id="try-it-out">
<h1>Try It Out</h1>
<p>Let's fire up a python interpreter and get our hands dirty here:</p>
<pre class="literal-block">
(soupenv)$ python
</pre>
<pre class="code python small incremental literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">html</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'craigslist_results.html'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">listings</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'p'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'row'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
<span class="mi">100</span>
</pre>
<p class="incremental">That sounds about right. Let's see if we can get only those with location
data.</p>
</div>
<div class="slide" id="filtering-tricks">
<h1>Filtering Tricks</h1>
<p>Attribute filters given a <tt class="docutils literal">True</tt> value match tags with that attribute</p>
<p class="incremental">Location data was in the <tt class="docutils literal"><span class="pre">data-latitude</span></tt> and <tt class="docutils literal"><span class="pre">data-longitude</span></tt> attributes.</p>
<pre class="code python small incremental literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">location_attrs</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">...</span>     <span class="s">'data-longitude'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="o">...</span>     <span class="s">'data-latitude'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">locatable</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
<span class="o">...</span>     <span class="s">'p'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'row'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">location_attrs</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">locatable</span><span class="p">)</span>
<span class="mi">43</span>
</pre>
<p class="incremental">Great.  That worked nicely</p>
</div>
<div class="slide" id="parsing-a-row">
<h1>Parsing a Row</h1>
<p>Now that we have the rows we want, we need to parse them. We want to preserve:</p>
<ul class="incremental simple">
<li>Location data (latitude and longitude)</li>
<li>Source link (to craiglist detailed listing)</li>
<li>Description text</li>
<li>Price and size data</li>
</ul>
<p class="incremental">Which parts of a single row contain each of these elements?</p>
</div>
<div class="slide" id="extracting-location">
<h1>Extracting Location</h1>
<p>Location data is in the <tt class="docutils literal">data-</tt> attributes we used to filter rows.</p>
<div class="incremental container">
<p>We can read the HTML attributes of a 'tag' easily, using <tt class="docutils literal">attrs</tt>:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">row1</span> <span class="o">=</span> <span class="n">locatable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">row1</span><span class="o">.</span><span class="n">attrs</span>
<span class="p">{</span><span class="s">u'data-pid'</span><span class="p">:</span> <span class="s">u'3949023084'</span><span class="p">,</span> <span class="s">u'data-latitude'</span><span class="p">:</span> <span class="s">u'35.8625743108992'</span><span class="p">,</span>
 <span class="s">u'class'</span><span class="p">:</span> <span class="p">[</span><span class="s">u'row'</span><span class="p">],</span> <span class="s">u'data-longitude'</span><span class="p">:</span> <span class="s">u'-78.6232739959049'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">row1</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data-latitude'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">row1</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data-longitude'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span>
<span class="mf">35.8625743108992</span> <span class="o">-</span><span class="mf">78.6232739959049</span>
</pre>
</div>
</div>
<div class="slide" id="extracting-description-and-link">
<h1>Extracting Description and Link</h1>
<p>Where <tt class="docutils literal">find_all</tt> will find many elements, <tt class="docutils literal">find</tt> will only find the first
that matches the filters you provide.</p>
<div class="incremental container">
<p>Our targets are in the first <tt class="docutils literal">a</tt> tag in the <tt class="docutils literal">pl</tt> span inside our row:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">link</span> <span class="o">=</span> <span class="n">row1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'pl'</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
</pre>
</div>
<div class="incremental container">
<p>The link path will be in the attrs:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">path</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'href'</span><span class="p">]</span>
</pre>
</div>
<div class="incremental container">
<p>Text contained <em>inside</em> tags is in the <tt class="docutils literal">string</tt> property:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">description</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre>
</div>
</div>
<div class="slide" id="extracting-price-and-size">
<h1>Extracting Price and Size</h1>
<p>Both price and size are held in the <tt class="docutils literal">pnr</tt> span:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">pnr</span> <span class="o">=</span> <span class="n">row1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'pnr'</span><span class="p">)</span>
</pre>
<div class="incremental container">
<p>Price, conveniently, is in it's own container:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">price_span</span> <span class="o">=</span> <span class="n">pnr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'price'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">price</span> <span class="o">=</span> <span class="n">price_span</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre>
</div>
<p class="incremental">But the size element is not. It is a standalone <em>text node</em>.</p>
<p class="incremental">Try finding it by reading the <tt class="docutils literal">string</tt> property of our <cite>pnr</cite> tag.</p>
</div>
<div class="slide" id="simple-navigation-and-text">
<h1>Simple Navigation and Text</h1>
<p>We can get to a simple text node by navigating there.</p>
<p class="incremental">BeautifulSoup tags support navigation up, down and across document nodes.</p>
<div class="incremental container">
<p>We already have the <tt class="docutils literal">price</tt> span, the size text node is next at the same
level:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">size</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">next_sibling</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">' </span><span class="se">\n</span><span class="s">-/'</span><span class="p">)</span>
<span class="s">u'2br - 1160ft</span><span class="se">\xb2</span><span class="s">'</span>
</pre>
</div>
<p class="incremental">You may have noticed that we keep using <tt class="docutils literal">strip</tt>. There are two reasons for
this.</p>
</div>
<div class="slide" id="the-navigablestring-element">
<h1>The NavigableString Element</h1>
<p>The most obvious reason is that we don't really want all the extra whitespace.</p>
<p class="incremental">The second reason is more subtle. The values returned by <tt class="docutils literal">string</tt> are
<strong>not</strong> simple unicode strings</p>
<div class="incremental container">
<p>They are actually instances of a class called <tt class="docutils literal">NavigableString</tt>:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">price</span><span class="o">.</span><span class="n">next_sibling</span><span class="o">.</span><span class="n">__class__</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">bs4</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">NavigableString</span><span class="s">'&gt;</span>
</pre>
</div>
<p class="incremental">These things hold references to their surroundings.</p>
<p class="incremental">Calling <tt class="docutils literal">strip</tt> or casting them to <tt class="docutils literal">unicode</tt> converts them, saving memory</p>
</div>
<div class="slide" id="put-it-all-together">
<h1>Put It All Together</h1>
<p>Okay, a challenge.  Combine everything we've done into a function that:</p>
<ul class="incremental simple">
<li>Extracts all the locatable listings from our html page</li>
<li>Iterates over each of them, and builds a dictionary of data
* include <tt class="docutils literal">location</tt>, <tt class="docutils literal">href</tt>, <tt class="docutils literal">description</tt>, <tt class="docutils literal">price</tt> and <tt class="docutils literal">size</tt></li>
<li>Returns a list of these dictionaries</li>
</ul>
<p class="incremental">Call it <tt class="docutils literal">extract_listings</tt></p>
<p class="incremental">Put this new function into <tt class="docutils literal">mashup.py</tt> and call it from <tt class="docutils literal">__main__</tt>,
printing the result</p>
</div>
<div class="slide" id="id3">
<h1>My Solution</h1>
<pre class="code python small incremental literal-block">
<span class="k">def</span> <span class="nf">extract_listings</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="n">location_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s">'data-latitude'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                      <span class="s">'data-longitude'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'p'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'row'</span><span class="p">,</span>
                            <span class="n">attrs</span><span class="o">=</span><span class="n">location_attrs</span><span class="p">):</span>
        <span class="n">location</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">location_attrs</span><span class="p">])</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'pl'</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
        <span class="n">price_span</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'price'</span><span class="p">)</span>
        <span class="n">listing</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'location'</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
            <span class="s">'href'</span><span class="p">:</span> <span class="n">link</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'href'</span><span class="p">],</span>
            <span class="s">'description'</span><span class="p">:</span> <span class="n">link</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s">'price'</span><span class="p">:</span> <span class="n">price_span</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s">'size'</span><span class="p">:</span> <span class="n">price_span</span><span class="o">.</span><span class="n">next_sibling</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">' </span><span class="se">\n</span><span class="s">-/'</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="n">listing</span>
</pre>
</div>
<div class="slide" id="id4">
<h1>My Solution</h1>
<pre class="code python small literal-block">
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'minAsk'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">'maxAsk'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">html</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">fetch_search_results</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">parse_source</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">listing</span> <span class="ow">in</span> <span class="n">extract_listings</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
        <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">listing</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="another-approach">
<h1>Another Approach</h1>
<p>Scraping web pages is tedious and inherently brittle</p>
<p class="incremental">The owner of the website updates their layout, your code breaks</p>
<p class="incremental">But there is another way to get information from the web in a more normalized
fashion</p>
<p class="incremental center"><strong>Web Services</strong></p>
</div>
<div class="slide" id="web-services">
<h1>Web Services</h1>
<p>&quot;a software system designed to support interoperable machine-to-machine
interaction over a network&quot; - W3C</p>
<ul class="incremental simple">
<li>provides a defined set of calls</li>
<li>returns structured data</li>
</ul>
</div>
<div class="slide" id="early-web-services">
<h1>Early Web Services</h1>
<p>RSS is one of the earliest forms of Web Services</p>
<ul class="simple">
<li>First known as <tt class="docutils literal">RDF Site Summary</tt></li>
<li>Became <tt class="docutils literal">Really Simple Syndication</tt></li>
<li>More at <a class="reference external" href="http://www.rss-specification.com/rss-specifications.htm">http://www.rss-specification.com/rss-specifications.htm</a></li>
</ul>
<p class="incremental">A single web-based <em>endpoint</em> provides a dynamically updated listing of
content</p>
<p class="incremental">Implemented in pure HTTP.  Returns XML</p>
<p class="incremental"><strong>Atom</strong> is a competing, but similar standard</p>
</div>
<div class="slide" id="rss-document">
<h1>RSS Document</h1>
<pre class="tiny literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;rss version=&quot;2.0&quot;&gt;
&lt;channel&gt;
  &lt;title&gt;RSS Title&lt;/title&gt;
  &lt;description&gt;This is an example of an RSS feed&lt;/description&gt;
  &lt;link&gt;http://www.someexamplerssdomain.com/main.html&lt;/link&gt;
  &lt;lastBuildDate&gt;Mon, 06 Sep 2010 00:01:00 +0000 &lt;/lastBuildDate&gt;
  &lt;pubDate&gt;Mon, 06 Sep 2009 16:45:00 +0000 &lt;/pubDate&gt;
  &lt;ttl&gt;1800&lt;/ttl&gt;

  &lt;item&gt;
    &lt;title&gt;Example entry&lt;/title&gt;
    &lt;description&gt;Here is some text containing an interesting description.&lt;/description&gt;
    &lt;link&gt;http://www.wikipedia.org/&lt;/link&gt;
    &lt;guid&gt;unique string per item&lt;/guid&gt;
    &lt;pubDate&gt;Mon, 06 Sep 2009 16:45:00 +0000 &lt;/pubDate&gt;
  &lt;/item&gt;
  ...
&lt;/channel&gt;
&lt;/rss&gt;
</pre>
</div>
<div class="slide" id="xml-rpc">
<h1>XML-RPC</h1>
<p>RSS provides a pre-defined data set, can we also allow <em>calling procedures</em> to
get more dynamic data?</p>
<p class="incremental">We can!  Enter XML-RPC (Remote Procedure Call)</p>
<ul class="incremental simple">
<li>Provides a set of defined procedures which can take arguments</li>
<li>Calls are made via HTTP GET, by passing an XML document</li>
<li>Returns from a call are sent to the client in XML</li>
</ul>
<p class="incremental">There is an interactive example of this at the end of this session. We will
not go through it here, though.</p>
</div>
<div class="slide" id="beyond-xml-rpc">
<h1>Beyond XML-RPC</h1>
<ul class="incremental simple">
<li>XML-RPC allows introspection</li>
<li>XML-RPC forces you to introspect to get information</li>
<li><em>Wouldn't it be nice to get that automatically?</em></li>
<li>XML-RPC provides data types</li>
<li>XML-RPC provides only <em>certain</em> data types</li>
<li><em>Wouldn't it be nice to have an extensible system for types?</em></li>
<li>XML-RPC allows calling methods with parameters</li>
<li>XML-RPC only allows calling methods, nothing else</li>
<li><em>wouldn't it be nice to have contextual data as well?</em></li>
</ul>
<p class="incremental center"><strong>Enter SOAP: Simple Object Access Protocol</strong></p>
</div>
<div class="slide" id="soap">
<h1>SOAP</h1>
<p>SOAP extends XML-RPC in a couple of useful ways:</p>
<ul class="incremental simple">
<li>It uses Web Services Description Language (WSDL) to provide meta-data about
an entire service in a machine-readable format (Automatic introspection)</li>
<li>It establishes a method for extending available data types using XML
namespaces</li>
<li>It provides a wrapper around method calls called the <strong>envelope</strong>, which
allows the inclusion of a <strong>header</strong> with system meta-data that can be used
by the application</li>
</ul>
</div>
<div class="slide" id="soap-in-python">
<h1>SOAP in Python</h1>
<p>There is no standard library module that supports SOAP directly.</p>
<ul class="incremental simple">
<li>The best-known and best-supported module available is <strong>Suds</strong></li>
<li>The homepage is <a class="reference external" href="https://fedorahosted.org/suds/">https://fedorahosted.org/suds/</a></li>
<li>It can be installed using <tt class="docutils literal">easy_install</tt> or <tt class="docutils literal">pip install</tt></li>
</ul>
<p class="incremental">Again, there is a good example of using SOAP via the <tt class="docutils literal">suds</tt> library at the
end of this session.</p>
<p class="incremental">But we're going to move on</p>
</div>
<div class="slide" id="afterword">
<h1>Afterword</h1>
<p>SOAP (and XML-RPC) have some problems:</p>
<ul class="incremental simple">
<li>XML is pretty damned inefficient as a data transfer medium</li>
<li>Why should I need to know method names?</li>
<li>If I can discover method names at all, I have to read a WSDL to do it?</li>
</ul>
<p class="incremental">Suds is the best we have, and it hasn't been updated since Sept. 2010.</p>
</div>
<div class="slide" id="if-not-xml-then-what">
<h1>If Not XML, Then What?</h1>
<p class="big-centered incremental"><strong>JSON</strong></p>
</div>
<div class="slide" id="json">
<h1>JSON</h1>
<p>JavaScript Object Notation:</p>
<ul class="incremental simple">
<li>a lightweight data-interchange format</li>
<li>easy for humans to read and write</li>
<li>easy for machines to parse and generate</li>
</ul>
<p class="incremental">Based on Two Structures:</p>
<ul class="incremental simple">
<li>object: <tt class="docutils literal">{ string: value, <span class="pre">...}</span></tt></li>
<li>array: <tt class="docutils literal">[value, value, ]</tt></li>
</ul>
<p class="center incremental">pythonic, no?</p>
</div>
<div class="slide" id="json-data-types">
<h1>JSON Data Types</h1>
<p>JSON provides a few basic data types (see <a class="reference external" href="http://json.org/">http://json.org/</a>):</p>
<ul class="incremental simple">
<li>string: unicode, anything but &quot;, \ and control characters</li>
<li>number: any number, but json does not use octal or hexidecimal</li>
<li>object, array (we've seen these above)</li>
<li>true</li>
<li>false</li>
<li>null</li>
</ul>
<p class="incremental center"><strong>No date type? OMGWTF??!!1!1</strong></p>
</div>
<div class="slide" id="dates-in-json">
<h1>Dates in JSON</h1>
<p class="incremental">Option 1 - Unix Epoch Time (number):</p>
<pre class="code python small incremental literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">time</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="mf">1358212616.7691269</span>
</pre>
<p class="incremental">Option 2 - ISO 8661 (string):</p>
<pre class="code python small incremental literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">datetime</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="s">'2013-01-14T17:18:10.727240'</span>
</pre>
</div>
<div class="slide" id="json-in-python">
<h1>JSON in Python</h1>
<p>You can encode python to json, and decode json back to python:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">json</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">orig</span> <span class="o">=</span> <span class="p">{</span><span class="s">'foo'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s">'bar'</span><span class="p">:</span> <span class="s">u'my resum'</span><span class="p">,</span> <span class="s">'baz'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">encoded</span>
<span class="s">'{&quot;baz&quot;: true, &quot;foo&quot;: [1, 2, 3], &quot;bar&quot;: &quot;my resum</span><span class="se">\\</span><span class="s">u00e9&quot;}'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">decoded</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">decoded</span> <span class="o">==</span> <span class="n">orig</span>
<span class="bp">True</span>
</pre>
<p class="incremental">Customizing the encoder or decoder class allows for specialized serializations</p>
</div>
<div class="slide" id="id5">
<h1>JSON in Python</h1>
<p>the json module also supports reading and writing to <em>file-like objects</em> via
<tt class="docutils literal">json.dump(fp)</tt> and <tt class="docutils literal">json.load(fp)</tt> (note the missing 's')</p>
<p class="incremental">Remember duck-typing. Anything with a <tt class="docutils literal">.write</tt> and a <tt class="docutils literal">.read</tt> method is
<em>file-like</em></p>
<p class="incremental">Have we seen any network-related classes recently that behave that way?</p>
</div>
<div class="slide" id="what-about-wsdl">
<h1>What about WSDL?</h1>
<p>SOAP was invented in part to provide completely machine-readable
interoperability.</p>
<p class="incremental">Does that really work in real life?</p>
<p class="incremental center">Hardly ever</p>
</div>
<div class="slide" id="id6">
<h1>What about WSDL?</h1>
<p>Another reason was to provide extensibility via custom types</p>
<p class="incremental">Does that really work in real life?</p>
<p class="incremental center">Hardly ever</p>
</div>
<div class="slide" id="why-do-all-the-work">
<h1>Why Do All The Work?</h1>
<p>So, if neither of these goals is really achieved by using SOAP, why pay all
the overhead required to use the protocol?</p>
<p class="incremental">Enter REST</p>
</div>
<div class="slide" id="rest">
<h1>REST</h1>
<p class="center">Representational State Transfer</p>
<ul class="incremental simple">
<li>Originally described by Roy T. Fielding (did you read it?)</li>
<li>Use HTTP for what it can do</li>
<li>Read more in <a class="reference external" href="http://www.crummy.com/writing/RESTful-Web-Services/">this book</a>*</li>
</ul>
<p class="image-credit incremental">* Seriously. Buy it and read
(&lt;<a class="reference external" href="http://www.crummy.com/writing/RESTful-Web-Services/">http://www.crummy.com/writing/RESTful-Web-Services/</a>)</p>
</div>
<div class="slide" id="a-comparison">
<h1>A Comparison</h1>
<p>The XML-RCP/SOAP way:</p>
<ul class="incremental small simple">
<li>POST /getComment HTTP/1.1</li>
<li>POST /getComments HTTP/1.1</li>
<li>POST /addComment HTTP/1.1</li>
<li>POST /editComment HTTP/1.1</li>
<li>POST /deleteComment HTTP/1.1</li>
</ul>
<p class="incremental">The RESTful way:</p>
<ul class="incremental small simple">
<li>GET /comment/&lt;id&gt; HTTP/1.1</li>
<li>GET /comment HTTP/1.1</li>
<li>POST /comment HTTP/1.1</li>
<li>PUT /comment/&lt;id&gt; HTTP/1.1</li>
<li>DELETE /comment/&lt;id&gt; HTTP/1.1</li>
</ul>
</div>
<div class="slide" id="roa">
<h1>ROA</h1>
<p>This is <strong>Resource Oriented Architecture</strong></p>
<p class="incremental">The URL represents the <em>resource</em> we are working with</p>
<p class="incremental">The HTTP Verb represents the <tt class="docutils literal">action</tt> to be taken</p>
<p class="incremental">The HTTP Code returned tells us the <tt class="docutils literal">result</tt> (whether success or failure)</p>
</div>
<div class="slide" id="http-codes-revisited">
<h1>HTTP Codes Revisited</h1>
<p class="small">POST /comment HTTP/1.1  (creating a new comment):</p>
<ul class="incremental small simple">
<li>Success: <tt class="docutils literal">HTTP/1.1 201 Created</tt></li>
<li>Failure (unauthorized): <tt class="docutils literal">HTTP/1.1 401 Unauthorized</tt></li>
<li>Failure (NotImplemented): <tt class="docutils literal">HTTP/1.1 405 Not Allowed</tt></li>
<li>Failure (ValueError): <tt class="docutils literal">HTTP/1.1 406 Not Acceptable</tt></li>
</ul>
<p class="small incremental">PUT /comment/&lt;id&gt; HTTP/1.1 (edit comment):</p>
<ul class="incremental small simple">
<li>Success: <tt class="docutils literal">HTTP/1.1 200 OK</tt></li>
<li>Failure: <tt class="docutils literal">HTTP/1.1 409 Conflict</tt></li>
</ul>
<p class="small incremental">DELETE /comment/&lt;id&gt; HTTP/1.1 (delete comment):</p>
<ul class="incremental small simple">
<li>Success: <tt class="docutils literal">HTTP/1.1 204 No Content</tt></li>
</ul>
</div>
<div class="slide" id="http-is-stateless">
<h1>HTTP Is Stateless</h1>
<p>No individual request may be assumed to know anything about any other request.</p>
<p class="incremental">All the required information for to represent the possible actions to take
<em>should be present in either the request or the response</em>.</p>
<p class="incremental big-centered">Thus:  HATEOAS</p>
</div>
<div class="slide" id="hateoas">
<h1>HATEOAS</h1>
<p class="big-centered">Hypermedia As The Engine Of Application State</p>
</div>
<div class="slide" id="applications-are-state-engines">
<h1>Applications are State Engines</h1>
<p>A State Engine is a machine that provides <em>states</em> for a resource to be in and
<em>transitions</em> to move resources between states.  A Restful api should:</p>
<ul class="incremental simple">
<li>provide information about the current state of a resource</li>
<li>provide information about available transitions for that resource (URIs)</li>
<li>provide all this in <em>each</em> HTTP response</li>
</ul>
</div>
<div class="slide" id="playing-with-rest">
<h1>Playing With REST</h1>
<p>Let's take a moment to play with REST.</p>
<p class="incremental">We'll use a common, public API provided by Google.</p>
<p class="incremental center"><strong>Geocoding</strong></p>
</div>
<div class="slide" id="geocoding-with-google-apis">
<h1>Geocoding with Google APIs</h1>
<p><a class="reference external" href="https://developers.google.com/maps/documentation/geocoding">https://developers.google.com/maps/documentation/geocoding</a></p>
<div class="incremental container">
<p>Open a python interpreter using our virtualenv:</p>
<pre class="small literal-block">
(soupenv)$ python
</pre>
</div>
<pre class="code python small incremental literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">requests</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">json</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="s">'http://maps.googleapis.com/maps/api/geocode/json'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">addr</span> <span class="o">=</span> <span class="s">'120 E. Cameron Avenue Chapel Hill, NC 27599'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">'address'</span><span class="p">:</span> <span class="n">addr</span><span class="p">,</span> <span class="s">'sensor'</span><span class="p">:</span> <span class="s">'false'</span> <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'OK'</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="reverse-geocoding">
<h1>Reverse Geocoding</h1>
<p>You can do the same thing in reverse, supply latitude and longitude and get
back address information:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">location</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">[</span><span class="s">'results'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'geometry'</span><span class="p">][</span><span class="s">'location'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">latlng</span> <span class="o">=</span> <span class="s">'</span><span class="si">%f</span><span class="s">,</span><span class="si">%f</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="s">'lat'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'lng'</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">'latlng'</span><span class="p">:</span> <span class="n">latlng</span><span class="p">,</span> <span class="s">'sensor'</span><span class="p">:</span> <span class="s">'false'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">paramters</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'OK'</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<p class="incremental">Notice that there are a number of results returned, ordered from most specific
to least.</p>
</div>
<div class="slide" id="mash-it-up">
<h1>Mash It Up</h1>
<p>Let's add a new function to <tt class="docutils literal">mashup.py</tt>.  It will:</p>
<ul class="incremental simple">
<li>take a single listing from our craiglist work</li>
<li>format the location data provided in that listing properly</li>
<li>make a reverse geocoding lookup using the google api above</li>
<li>add the best available address to the listing</li>
<li>return the updated listing</li>
</ul>
<p class="incremental">Call it <tt class="docutils literal">add_address</tt></p>
</div>
<div class="slide" id="id7">
<h1>My Solution</h1>
<pre class="code python small incremental literal-block">
<span class="c"># add an import</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c"># and a function</span>
<span class="k">def</span> <span class="nf">add_address</span><span class="p">(</span><span class="n">listing</span><span class="p">):</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s">'http://maps.googleapis.com/maps/api/geocode/json'</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">listing</span><span class="p">[</span><span class="s">'location'</span><span class="p">]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'sensor'</span><span class="p">:</span> <span class="s">'false'</span><span class="p">,</span>
        <span class="s">'latlng'</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="s">'data-latitude'</span><span class="p">],</span>
                             <span class="n">loc</span><span class="p">[</span><span class="s">'data-longitude'</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'OK'</span><span class="p">:</span>
        <span class="n">best</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'results'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">listing</span><span class="p">[</span><span class="s">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="s">'formatted_address'</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">listing</span><span class="p">[</span><span class="s">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'unavailable'</span>
    <span class="k">return</span> <span class="n">listing</span>
</pre>
</div>
<div class="slide" id="add-address-to-output">
<h1>Add Address to Output</h1>
<p>Go ahead and bolt the new function into our <tt class="docutils literal">__main__</tt> block:</p>
<pre class="code python small incremental literal-block">
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'minAsk'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">'maxAsk'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">html</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">fetch_search_results</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">parse_source</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">listing</span> <span class="ow">in</span> <span class="n">extract_listings</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
        <span class="n">listing</span> <span class="o">=</span> <span class="n">add_address</span><span class="p">(</span><span class="n">listing</span><span class="p">)</span>
        <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">listing</span><span class="p">)</span>
</pre>
<div class="incremental container">
<p>And give the result a whirl:</p>
<pre class="small literal-block">
(soupenv)$ python mashup.py
{'address': u'800 Bethlehem Road, Knightdale, NC 27545, USA',
 'description': u'3 bedroom 2 bathroom unit is move in ready!'
 ...
}
</pre>
</div>
</div>
<div class="slide" id="one-more-step">
<h1>One More Step</h1>
<p>I'm a big fan of walking places.</p>
<p class="incremental">So I'd like to find an apartment that is located somewhere 'walkable'</p>
<p class="incremental">There's an API for that!</p>
<p class="incremental"><a class="reference external" href="http://www.walkscore.com/professional/api.php">http://www.walkscore.com/professional/api.php</a></p>
<p class="incremental">Take a second here and sign up for an api key. Use a real email address,
they'll email you an API key.</p>
</div>
<div class="slide" id="getting-a-walk-score">
<h1>Getting a Walk Score</h1>
<p>The API documentation tells us we have to provide lat, lon and address to get
a walk score, along with our API key.</p>
<p class="incremental">It also tells us we have a choice of XML or JSON output.  Let's use JSON</p>
<p class="incremental">Let's poke at it and see what we get back</p>
<p class="incremental">Fire up your virtualenv Python interpreter again</p>
</div>
<div class="slide" id="making-an-api-call">
<h1>Making an API Call</h1>
<pre class="literal-block">
(soupenv)$ python
</pre>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">requests</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">json</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">api_url</span> <span class="o">=</span> <span class="s">'http://api.walkscore.com/score'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="mf">35.9108986</span><span class="p">,</span> <span class="o">-</span><span class="mf">79.053783</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">addr</span> <span class="o">=</span> <span class="s">'120 E. Cameron Avenue Chapel Hill, NC 27599'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'lat'</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span> <span class="s">'lon'</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="s">'address'</span><span class="p">:</span> <span class="n">addr</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">params</span><span class="p">[</span><span class="s">'wsapikey'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'&lt;type your api key here&gt;'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">params</span><span class="p">[</span><span class="s">'format'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'json'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="id8">
<h1>Mash It Up</h1>
<p>Add a function to <tt class="docutils literal">mashup.py</tt> that:</p>
<ul class="incremental simple">
<li>takes a single listing from our craigslist search</li>
<li>uses the location and address to make a walkscore api call</li>
<li>adds the description, walkscore and ws_link parameters to the listing</li>
<li>returns the updated listing</li>
</ul>
<p class="incremental">Call the function <tt class="docutils literal">add_walkscore</tt></p>
<p class="incremental">Bolt it into our script's <tt class="docutils literal">__main__</tt> block where it fits best</p>
</div>
<div class="slide" id="id9">
<h1>My Solution</h1>
<pre class="code python small incremental literal-block">
<span class="k">def</span> <span class="nf">add_walkscore</span><span class="p">(</span><span class="n">listing</span><span class="p">):</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s">'http://api.walkscore.com/score'</span>
    <span class="n">apikey</span> <span class="o">=</span> <span class="s">'&lt;your api key goes here&gt;'</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">listing</span><span class="p">[</span><span class="s">'location'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">listing</span><span class="p">[</span><span class="s">'address'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'unavailable'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">listing</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'lat'</span><span class="p">:</span> <span class="n">loc</span><span class="p">[</span><span class="s">'data-latitude'</span><span class="p">],</span> <span class="s">'lon'</span><span class="p">:</span> <span class="n">loc</span><span class="p">[</span><span class="s">'data-longitude'</span><span class="p">],</span>
        <span class="s">'address'</span><span class="p">:</span> <span class="n">listing</span><span class="p">[</span><span class="s">'address'</span><span class="p">],</span> <span class="s">'wsapikey'</span><span class="p">:</span> <span class="n">apikey</span><span class="p">,</span>
        <span class="s">'format'</span><span class="p">:</span> <span class="s">'json'</span>
    <span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">listing</span><span class="p">[</span><span class="s">'ws_description'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'description'</span><span class="p">]</span>
        <span class="n">listing</span><span class="p">[</span><span class="s">'ws_score'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'walkscore'</span><span class="p">]</span>
        <span class="n">listing</span><span class="p">[</span><span class="s">'ws_link'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'ws_link'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">listing</span>
</pre>
</div>
<div class="slide" id="my-results">
<h1>My Results</h1>
<pre class="code python small literal-block">
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'minAsk'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">'maxAsk'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">'bedrooms'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">html</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">fetch_search_results</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">parse_source</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">listing</span> <span class="ow">in</span> <span class="n">extract_listings</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
        <span class="n">listing</span> <span class="o">=</span> <span class="n">add_address</span><span class="p">(</span><span class="n">listing</span><span class="p">)</span>
        <span class="n">listing</span> <span class="o">=</span> <span class="n">add_walkscore</span><span class="p">(</span><span class="n">listing</span><span class="p">)</span>
        <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">listing</span><span class="p">)</span>
</pre>
<p class="incremental">Let's try it out:</p>
<pre class="literal-block">
(soupenv)$ python mashup.py
</pre>
</div>
<div class="slide" id="wrap-up">
<h1>Wrap Up</h1>
<p>We've built a simple mashup combining data from three different sources.</p>
<p class="incremental">As a result we can now make a listing of apartments ranked by the walkability
of their neighborhood.</p>
<p class="incremental">What other data sources might we use? Check out
<a class="reference external" href="http://www.programmableweb.com/apis/directory">http://www.programmableweb.com/apis/directory</a> to see some of the possibilities</p>
</div>
<div class="slide" id="next-steps">
<h1>Next Steps</h1>
<p>We've spent this session consuming data produced by other people.</p>
<p class="incremental">In the next session we'll see how to take input from clients and use it to
create our own responses.</p>
<p class="incremental">See you back here soon!</p>
</div>
<div class="slide" id="addenda">
<h1>Addenda</h1>
<p>The following are provided as self-directed exercises. We just don't have the
time to cover them in depth in class.</p>
</div>
<div class="slide" id="id10">
<h1>XML-RPC</h1>
<p>Examples of XML-RPC using the Python Standard Library</p>
</div>
<div class="slide" id="xml-rpc-example-server">
<h1>XML-RPC Example - Server</h1>
<p>xmlrpc_server.py:</p>
<pre class="code python small literal-block">
<span class="kn">from</span> <span class="nn">SimpleXMLRPCServer</span> <span class="kn">import</span> <span class="n">SimpleXMLRPCServer</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">SimpleXMLRPCServer</span><span class="p">((</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">50000</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Use Ctrl-C to Exit&quot;</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Exiting&quot;</span>
</pre>
</div>
<div class="slide" id="xml-rpc-example-client">
<h1>XML-RPC Example - Client</h1>
<p>We can run a client from a terminal. First, open one terminal and run the
xmlrpc_server.py script:</p>
<blockquote>
$ python xmlrcp_server.py</blockquote>
<p>Then, open another terminal and start up python:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">xmlrpclib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">proxy</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="s">'http://localhost:50000'</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">proxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">72</span>
</pre>
</div>
<div class="slide" id="xml-rpc-request">
<h1>XML-RPC Request</h1>
<p><tt class="docutils literal">verbose=True</tt> allows us to see the request we sent:</p>
<pre class="tiny literal-block">
POST /RPC2 HTTP/1.0
Host: localhost:50000
User-Agent: xmlrpclib.py/1.0.1 (by www.pythonware.com)
Content-Type: text/xml
Content-Length: 192

&lt;?xml version='1.0'?&gt;
&lt;methodCall&gt;
 &lt;methodName&gt;multiply&lt;/methodName&gt;
 &lt;params&gt;
  &lt;param&gt;
   &lt;value&gt;&lt;int&gt;3&lt;/int&gt;&lt;/value&gt;
  &lt;/param&gt;
  &lt;param&gt;
   &lt;value&gt;&lt;int&gt;24&lt;/int&gt;&lt;/value&gt;
  &lt;/param&gt;
 &lt;/params&gt;
&lt;/methodCall&gt;
</pre>
</div>
<div class="slide" id="xml-rpc-response">
<h1>XML-RPC Response</h1>
<p>and we can see the response, too:</p>
<pre class="tiny literal-block">
HTTP/1.0 200 OK
Server: BaseHTTP/0.3 Python/2.6.1
Date: Sun, 13 Jan 2013 03:38:00 GMT
Content-type: text/xml
Content-length: 121

&lt;?xml version='1.0'?&gt;
&lt;methodResponse&gt;
 &lt;params&gt;
  &lt;param&gt;
   &lt;value&gt;&lt;int&gt;72&lt;/int&gt;&lt;/value&gt;
  &lt;/param&gt;
 &lt;/params&gt;
&lt;/methodResponse&gt;
</pre>
</div>
<div class="slide" id="more-xml-rpc">
<h1>More XML-RPC</h1>
<p>Register an entire Python class as a service, exposing class methods:</p>
<pre class="literal-block">
server.register_instance(MyClass())
</pre>
<p>Keep an instance method private    :</p>
<pre class="code python tiny literal-block">
<span class="k">class</span> <span class="nc">MyServiceClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">public_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;this method is public&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_private_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;this method is private because it starts with '_'
        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre>
</div>
<div class="slide" id="xml-rpc-introspection">
<h1>XML-RPC Introspection</h1>
<p>First, implement required methods on your service class:</p>
<pre class="code python tiny literal-block">
<span class="kn">from</span> <span class="nn">SimpleXMLRPCServer</span> <span class="kn">import</span> <span class="n">list_public_methods</span>

<span class="k">class</span> <span class="nc">MyServiceClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">_listMethods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;custom logic for presenting method names to users

        list_public_methods is a convenience function from the Python
        library, but you can make your own logic if you wish.
        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">list_public_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_methodHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;provide help text for an individual method
        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">__doc__</span>
</pre>
</div>
<div class="slide" id="id11">
<h1>XML-RPC Introspection</h1>
<p>Then enable introspection via the server instance:</p>
<pre class="code python small literal-block">
<span class="n">server</span><span class="o">.</span><span class="n">register_introspection_functions</span><span class="p">()</span>
</pre>
<p>After this, a client proxy can call pre-defined methods to learn about what
your service offers:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">proxy</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">listMethods</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">help</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">methodHelp</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">print</span> <span class="n">name</span>
<span class="o">...</span>     <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">help</span>
<span class="o">...</span>
<span class="n">public_method</span>
    <span class="n">this</span> <span class="n">method</span> <span class="ow">is</span> <span class="n">public</span>
</pre>
</div>
<div class="slide" id="introspection-question">
<h1>Introspection Question</h1>
<p>I told you when we added the <tt class="docutils literal">_private_method</tt> that any method that any
method whose name starts with <tt class="docutils literal">_</tt> would be <strong>private</strong>.</p>
<p class="incremental">But we also added a <tt class="docutils literal">_listMethods</tt> method and a <tt class="docutils literal">_methodHelp</tt> method and
<em>those</em> methods are listed when you run <tt class="docutils literal">proxy.system.listMethods()</tt></p>
<p class="incremental">Why is this?</p>
<p class="incremental">For a complete discussion of this, read <a class="reference external" href="http://pymotw.com/2/SimpleXMLRPCServer/index.html#introspection-api">this MOTW post</a></p>
</div>
<div class="slide" id="id12">
<h1>SOAP</h1>
<p>Example of Using SOAP via the <tt class="docutils literal">suds</tt> package</p>
</div>
<div class="slide" id="install-suds">
<h1>Install Suds</h1>
<ul class="simple">
<li>Quit your python interpreter if you have it running.</li>
<li>If you see (soupenv) at your command line prompt, cool.</li>
<li>If you do not, type <tt class="docutils literal">source /path/to/soupenv/bin/activate</tt></li>
<li>Windows folks: <tt class="docutils literal">&gt; \path\to\soupenv\Scripts\activate</tt></li>
<li>Once activated: <tt class="docutils literal">pip install suds</tt></li>
</ul>
</div>
<div class="slide" id="creating-a-suds-client">
<h1>Creating a Suds Client</h1>
<p>Suds allows us to create a SOAP client object. SOAP uses WSDL to define a
service. All we need to do to set this up in python is load the URL of the
WSDL for the service we want to use:</p>
<pre class="code python small literal-block">
<span class="p">(</span><span class="n">soupenv</span><span class="p">)</span><span class="err">$</span> <span class="n">python</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">suds.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">geo_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s">'https://geoservices.tamu.edu/Services/Geocode/WebService/GeocoderService_V03_01.asmx?wsdl'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">geo_client</span>
<span class="o">&lt;</span><span class="n">suds</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10041fc10</span><span class="o">&gt;</span>
</pre>
</div>
<div class="slide" id="peeking-at-the-service">
<h1>Peeking at the Service</h1>
<p>Suds allows us to visually scan the service. Simply print the client object to
see what the service has to offer:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">geo_client</span>

<span class="n">Suds</span> <span class="p">(</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">fedorahosted</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">suds</span><span class="o">/</span> <span class="p">)</span>  <span class="n">version</span><span class="p">:</span> <span class="mf">0.4</span> <span class="n">GA</span>  <span class="n">build</span><span class="p">:</span> <span class="n">R699</span><span class="o">-</span><span class="mi">20100913</span>

<span class="n">Service</span> <span class="p">(</span> <span class="n">GeocoderService_V03_01</span> <span class="p">)</span> <span class="n">tns</span><span class="o">=</span><span class="s">&quot;https://geoservices.tamu.edu/&quot;</span>
   <span class="n">Prefixes</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">ns0</span> <span class="o">=</span> <span class="s">&quot;https://geoservices.tamu.edu/&quot;</span>
   <span class="n">Ports</span> <span class="p">(</span><span class="mi">2</span><span class="p">):</span>
      <span class="p">(</span><span class="n">GeocoderService_V03_01Soap</span><span class="p">)</span>
      <span class="n">Methods</span> <span class="p">(</span><span class="mi">4</span><span class="p">):</span>
         <span class="o">...</span>
      <span class="n">Types</span> <span class="p">(</span><span class="mi">12</span><span class="p">):</span>
         <span class="o">...</span>
</pre>
</div>
<div class="slide" id="debugging-suds">
<h1>Debugging Suds</h1>
<p>Suds uses python logging to deal with debug information, so if you want to see
what's going on under the hood, you configure it via the Python logging
module:</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'suds.client'</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre>
<p class="incremental">This will allow us to see the messages sent and received by our client.</p>
</div>
<div class="slide" id="client-options">
<h1>Client Options</h1>
<p>SOAP Servers can provide more than one <em>service</em> and each <em>service</em> might have
more than one <em>port</em>. Suds provides two ways to configure which <em>service</em> and
<em>port</em> you wish to use.</p>
<p>Via subscription:</p>
<pre class="code python literal-block">
<span class="n">client</span><span class="o">.</span><span class="n">service</span><span class="p">[</span><span class="s">'&lt;service&gt;'</span><span class="p">][</span><span class="s">'&lt;port&gt;'</span><span class="p">]</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre>
<p>Or the way we will do it, via configuration:</p>
<pre class="code python literal-block">
<span class="n">geo_client</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s">'GeocoderService_V03_01'</span><span class="p">,</span>
                       <span class="n">port</span><span class="o">=</span><span class="s">'GeocoderService_V03_01Soap'</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="providing-arguments">
<h1>Providing Arguments</h1>
<p>Arguments to a method are set up as a dictionary.  Although some may not be
required according to api documentation, it is safest to provide them all:</p>
<pre class="code python small literal-block">
<span class="n">apiKey</span> <span class="o">=</span> <span class="s">'&lt;fill this in&gt;'</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s">'apiKey'</span><span class="p">:</span> <span class="n">apiKey</span><span class="p">,</span> <span class="p">}</span>
<span class="n">args</span><span class="p">[</span><span class="s">'streetAddress'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'1325 4th Avenue'</span>
<span class="n">args</span><span class="p">[</span><span class="s">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Seattle'</span>
<span class="n">args</span><span class="p">[</span><span class="s">'state'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'WA'</span>
<span class="n">args</span><span class="p">[</span><span class="s">'zip'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'98101'</span>
<span class="n">args</span><span class="p">[</span><span class="s">'version'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.01</span>
<span class="n">args</span><span class="p">[</span><span class="s">'shouldReturnReferenceGeometry'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">args</span><span class="p">[</span><span class="s">'shouldNotStoreTransactionDetails'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">args</span><span class="p">[</span><span class="s">'shouldCalculateCensus'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">args</span><span class="p">[</span><span class="s">'censusYear'</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;TwoThousandTen&quot;</span>
</pre>
</div>
<div class="slide" id="making-the-call">
<h1>Making the Call</h1>
<p>Finally, once we've got the arguments all ready we can go ahead and make a call
to the server:</p>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span> <span class="o">=</span> <span class="n">geo_client</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">GeocodeAddressNonParsed</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">suds</span><span class="o">.</span><span class="n">client</span><span class="p">:</span><span class="n">sending</span> <span class="n">to</span>
<span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">geoservices</span><span class="o">.</span><span class="n">tamu</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">Services</span><span class="o">/</span><span class="n">Geocode</span><span class="o">/</span><span class="n">WebService</span><span class="o">/</span><span class="n">GeocoderService_V03_01</span><span class="o">.</span><span class="n">asmx</span><span class="p">)</span>
<span class="n">message</span><span class="p">:</span>
<span class="o">...</span>
</pre>
</div>
<div class="slide" id="what-does-it-look-like">
<h1>What does it look like?</h1>
<pre class="tiny literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SOAP-ENV:Envelope xmlns:ns0=&quot;https://geoservices.tamu.edu/&quot; xmlns:ns1=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
   &lt;SOAP-ENV:Header/&gt;
   &lt;ns1:Body&gt;
      &lt;ns0:GeocodeAddressNonParsed&gt;
         &lt;ns0:streetAddress&gt;1325 4th Avenue&lt;/ns0:streetAddress&gt;
         &lt;ns0:city&gt;Seattle&lt;/ns0:city&gt;
         &lt;ns0:state&gt;WA&lt;/ns0:state&gt;
         &lt;ns0:zip&gt;98101&lt;/ns0:zip&gt;
         &lt;ns0:apiKey&gt;a450a9181f85498598e21f8a39440e9a&lt;/ns0:apiKey&gt;
         &lt;ns0:version&gt;3.01&lt;/ns0:version&gt;
         &lt;ns0:shouldCalculateCensus&gt;false&lt;/ns0:shouldCalculateCensus&gt;
         &lt;ns0:censusYear&gt;TwoThousandTen&lt;/ns0:censusYear&gt;
         &lt;ns0:shouldReturnReferenceGeometry&gt;true&lt;/ns0:shouldReturnReferenceGeometry&gt;
         &lt;ns0:shouldNotStoreTransactionDetails&gt;true&lt;/ns0:shouldNotStoreTransactionDetails&gt;
      &lt;/ns0:GeocodeAddressNonParsed&gt;
   &lt;/ns1:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</pre>
</div>
<div class="slide" id="and-the-reply">
<h1>And the Reply?</h1>
<pre class="tiny literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;soap:Body&gt;
    &lt;GeocodeAddressNonParsedResponse xmlns=&quot;https://geoservices.tamu.edu/&quot;&gt;
      &lt;GeocodeAddressNonParsedResult&gt;
        &lt;TransactionId&gt;6ef9c110-994c-4142-93d5-a55173526b64&lt;/TransactionId&gt;
        &lt;Latitude&gt;47.6084110119244&lt;/Latitude&gt;
        &lt;Longitude&gt;-122.3351592971042&lt;/Longitude&gt;
        &lt;Version&gt;3.01&lt;/Version&gt;
        &lt;Quality&gt;QUALITY_ADDRESS_RANGE_INTERPOLATION&lt;/Quality&gt;
        &lt;MatchedLocationType&gt;LOCATION_TYPE_STREET_ADDRESS&lt;/MatchedLocationType&gt;
        &lt;MatchType&gt;Exact&lt;/MatchType&gt;
        &lt;FeatureMatchingResultCount&gt;1&lt;/FeatureMatchingResultCount&gt;
        ...
        &lt;FArea&gt;2910.69420560356&lt;/FArea&gt;
        &lt;FAreaType&gt;Meters&lt;/FAreaType&gt;
        &lt;FGeometrySRID&gt;4269&lt;/FGeometrySRID&gt;
        &lt;FGeometry&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&amp;lt;LineString xmlns=&quot;http://www.opengis.net/gml&quot;&amp;gt;&amp;lt;posList&amp;gt;-122.334868 47.608226 -122.335777 47.609219&amp;lt;/posList&amp;gt;&amp;lt;/LineString&amp;gt;&lt;/FGeometry&gt;
        ...
      &lt;/GeocodeAddressNonParsedResult&gt;
    &lt;/GeocodeAddressNonParsedResponse&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre>
</div>
<div class="slide" id="and-what-of-our-result">
<h1>And What of Our Result?</h1>
<p>The WSDL we started with should provide type definitions for both data we send
and results we receive. The <tt class="docutils literal">res</tt> symbol we bound to our result earlier
should now be an instance of a <em>GeocodeAddressNonParsedResult</em>. Lets see what
that looks like:</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'instance'</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">dir</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="p">[</span><span class="s">'CensusTimeTaken'</span><span class="p">,</span> <span class="s">'CensusYear'</span><span class="p">,</span> <span class="s">'ErrorMessage'</span><span class="p">,</span> <span class="s">'FArea'</span><span class="p">,</span>
 <span class="s">'FAreaType'</span><span class="p">,</span> <span class="s">'FCity'</span><span class="p">,</span> <span class="s">'FCounty'</span><span class="p">,</span> <span class="s">'FCountySubRegion'</span><span class="p">,</span>
 <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">res</span><span class="o">.</span><span class="n">Latitude</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">Longitude</span>
<span class="p">(</span><span class="mf">47.608411011924403</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.3351592971042</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="a-word-on-debugging">
<h1>A Word on Debugging</h1>
<p class="center"><strong>blerg</strong></p>
<ul class="incremental simple">
<li>Messages sent to the server are long XML strings</li>
<li>Error messages are generally based on parsing errors in XML</li>
<li>These error messages can be quite cryptic:</li>
<li>&quot;There is an error in XML document (1, 572). ---&gt; The string '' is not a
valid Boolean value.'</li>
</ul>
<p class="incremental">Try this:</p>
<pre class="code python small incremental literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">geo_client</span><span class="o">.</span><span class="n">last_sent</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)[:</span><span class="mi">573</span><span class="p">]</span>
<span class="s">'...&lt;/ns0:version&gt;</span><span class="se">\n</span><span class="s">&lt;ns0:shouldCalculateCensus/&gt;'</span>
</pre>
</div>
</div>
</body>
</html>
